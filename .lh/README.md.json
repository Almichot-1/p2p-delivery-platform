{
    "sourceFile": "README.md",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1768024865424,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1768582629856,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,10 +1,142 @@\n # Diaspora Delivery\r\n \r\n A Flutter-based peer-to-peer delivery marketplace that connects travelers with people who need items delivered. Travelers can monetize their extra luggage space while requesters get their items delivered affordably through trusted community members.\r\n \r\n+## Final-Year Project Master Prompt (Copy-Paste)\r\n+\r\n+Use the following prompt with any AI agent (ChatGPT, Claude, Copilot, etc.) to generate a university-ready documentation package for this project.\r\n+\r\n+```text\r\n+Role and Context\r\n+You are a senior software engineer and academic project supervisor.\r\n+Your task is to generate a complete final-year project documentation package suitable for university submission, including formal documentation, system analysis, design artifacts, and diagrams.\r\n+\r\n+The output must follow formal academic standards. It must be well-structured, clear, and technically correct.\r\n+Avoid unnecessary verbosity, but ensure depth and completeness.\r\n+\r\n+1. Project Overview\r\n+Generate:\r\n+- Project Title\r\n+- Problem Statement\r\n+- Objectives (General and Specific)\r\n+- Scope of the System\r\n+- Target Users\r\n+- Assumptions and Constraints\r\n+\r\n+2. Software Development Approach (SDA)\r\n+Explain in detail:\r\n+- Chosen SDLC model (Waterfall, Agile, Incremental)\r\n+- Justification for choosing this model\r\n+- Each phase of the SDLC as applied to this project:\r\n+  - Requirements Analysis\r\n+  - System Design\r\n+  - Implementation\r\n+  - Testing\r\n+  - Deployment\r\n+  - Maintenance\r\n+\r\n+3. Requirements Analysis\r\n+3.1 Functional Requirements\r\n+List and explain clearly (numbered).\r\n+\r\n+3.2 Non-Functional Requirements\r\n+Include:\r\n+- Performance\r\n+- Security\r\n+- Scalability\r\n+- Usability\r\n+- Reliability\r\n+\r\n+4. System Actors and Use Cases\r\n+- Identify all system actors\r\n+- Explain each actor’s role\r\n+- Provide a Use Case List\r\n+\r\n+4.1 Use Case Diagram\r\n+- Describe it clearly\r\n+- Include PlantUML code for the diagram\r\n+\r\n+5. System Design\r\n+5.1 High-Level Architecture\r\n+- Describe system architecture (Client–Server, MVC, Layered)\r\n+- Provide an Architecture Diagram (PlantUML)\r\n+\r\n+5.2 Database Design\r\n+- Entity descriptions\r\n+- Relationships\r\n+- ER Diagram (PlantUML)\r\n+\r\n+6. UML Diagrams (Mandatory)\r\n+Generate PlantUML code for:\r\n+1) Use Case Diagram\r\n+2) Class Diagram\r\n+3) Sequence Diagram\r\n+4) Activity Diagram\r\n+5) Deployment Diagram\r\n+\r\n+For each diagram, include:\r\n+- A short explanation\r\n+- Correct UML notation\r\n+\r\n+7. Technology Stack\r\n+Explain:\r\n+- Frontend technology\r\n+- Backend technology\r\n+- Database\r\n+- Tools and IDEs\r\n+- Reason for choosing each\r\n+\r\n+8. Implementation Overview\r\n+- System modules\r\n+- Major classes and components\r\n+- Data flow explanation\r\n+Do not write full code unless explicitly asked.\r\n+\r\n+9. Testing Strategy\r\n+Explain:\r\n+- Unit Testing\r\n+- Integration Testing\r\n+- System Testing\r\n+- Acceptance Testing\r\n+Include a sample test case table.\r\n+\r\n+10. Security Considerations\r\n+Explain:\r\n+- Authentication\r\n+- Authorization\r\n+- Data validation\r\n+- Data protection\r\n+\r\n+11. Limitations and Future Enhancements\r\n+- Current system limitations\r\n+- Possible future improvements\r\n+\r\n+12. Conclusion\r\n+- Summary of the system\r\n+- Achievements\r\n+- Final remarks\r\n+\r\n+13. Documentation Style Rules\r\n+- Formal academic language\r\n+- Clear headings and subheadings\r\n+- No casual language\r\n+- Do not include phrases such as “as an AI model”\r\n+\r\n+14. Output Format\r\n+- Markdown\r\n+- Clearly separated sections\r\n+- Diagrams written using PlantUML code blocks\r\n+\r\n+Before generating the content, ask only once for:\r\n+- Project title or domain\r\n+- Platform (Web, Mobile, Desktop)\r\n+Then generate everything in one complete response.\r\n+```\r\n+\r\n ## Table of Contents\r\n \r\n+- [Final-Year Project Master Prompt (Copy-Paste)](#final-year-project-master-prompt-copy-paste)\r\n - [Overview](#overview)\r\n - [Features](#features)\r\n - [Architecture](#architecture)\r\n - [Project Structure](#project-structure)\r\n"
                }
            ],
            "date": 1768024865423,
            "name": "Commit-0",
            "content": "# Diaspora Delivery\r\n\r\nA Flutter-based peer-to-peer delivery marketplace that connects travelers with people who need items delivered. Travelers can monetize their extra luggage space while requesters get their items delivered affordably through trusted community members.\r\n\r\n## Table of Contents\r\n\r\n- [Overview](#overview)\r\n- [Features](#features)\r\n- [Architecture](#architecture)\r\n- [Project Structure](#project-structure)\r\n- [Tech Stack](#tech-stack)\r\n- [Getting Started](#getting-started)\r\n- [Configuration](#configuration)\r\n- [Database Schema](#database-schema)\r\n- [Feature Documentation](#feature-documentation)\r\n- [API Reference](#api-reference)\r\n- [Troubleshooting](#troubleshooting)\r\n- [Security Considerations](#security-considerations)\r\n\r\n## Project Status (Jan 2026)\r\n\r\n- Trips, Requests, Matches (lifecycle + creation flows) are implemented and running.\r\n- Chat is implemented per match and is available after match confirmation.\r\n- Notifications UI + repository are implemented; notifications are written by the app during match/chat events (no Cloud Functions required for MVP).\r\n- Firestore rules are currently in test mode (open) and must be tightened before production.\r\n\r\nSee also:\r\n- docs/requirements.md\r\n- docs/system_design.md\r\n\r\n## Overview\r\n\r\nDiaspora Delivery solves the problem of expensive international shipping by leveraging travelers who have extra luggage capacity. The platform enables:\r\n\r\n- **Travelers**: Post upcoming trips with available capacity and earn money by delivering items\r\n- **Requesters**: Post delivery requests for items they need transported and find matching travelers\r\n\r\nThe app handles the entire lifecycle from posting trips/requests, matching, negotiation, delivery tracking, and completion.\r\n\r\n## Features\r\n\r\n### Authentication\r\n- Email/password registration and login\r\n- Password reset via email\r\n- Persistent session management\r\n- Profile photo upload\r\n\r\n### Trips (Traveler Features)\r\n- Create trips with origin/destination cities\r\n- Set available capacity (kg) and price per kg\r\n- Specify accepted item types (Documents, Electronics, Clothing, Food, Medicine, Other)\r\n- Direction toggle (Ethiopia → Abroad or Abroad → Ethiopia)\r\n- City picker with common cities dropdown + manual entry option\r\n- View and manage your trips\r\n- See matching requests for your trips\r\n- Trip status management (active, completed, cancelled)\r\n\r\n### Requests (Requester Features)\r\n- Simplified single-form request creation\r\n- Item details: title, category, weight, description\r\n- Pickup and delivery location with city picker\r\n- Recipient information (name, phone)\r\n- Optional: preferred delivery date, offered price, urgency flag\r\n- Multi-image upload (up to 5 photos)\r\n- View and manage your requests\r\n- See matching trips for your requests\r\n\r\n### Smart Matching\r\n- Matching lists are computed based on:\r\n  - Route compatibility (origin/destination city)\r\n  - Trip must be upcoming and active\r\n  - Request must be active\r\n  - Capacity availability (request weight ≤ trip capacity)\r\n- Match request workflow with accept/reject\r\n- Agreed price negotiation\r\n\r\nPlanned (not guaranteed in current build):\r\n- Item type acceptance filtering\r\n- Deeper date compatibility (e.g., preferred delivery date vs trip departure)\r\n\r\n### Match Lifecycle\r\nStatus progression:\r\n```\r\npending → accepted → confirmed → pickedUp → inTransit → delivered → completed\r\n                ↘ rejected\r\n        (cancellation available until delivered)\r\n```\r\n\r\n### Real-time Chat\r\n- In-app messaging between matched users\r\n- Text and image messages\r\n- Message read receipts\r\n- Edit messages (within 12 hours)\r\n- Delete messages (within 12 hours)\r\n- System messages for status updates\r\n- Chat only available after match confirmation\r\n\r\n### Notifications\r\n- In-app notifications stored in Firestore and shown in the Notifications screen\r\n- Notification types include match requests, accept/reject/confirm, new messages, and status updates\r\n- Mark as read (single/all)\r\n- Swipe to delete\r\n- Clear all notifications\r\n\r\nNote: Push notifications (FCM) are optional and may require additional backend setup.\r\n\r\n### Search\r\n- Search trips by destination, city, traveler name\r\n- Search requests by title, city, requester name\r\n- Tabbed interface for trips and requests\r\n\r\n### Profile\r\n- View and edit profile information\r\n- Profile photo upload with cropping\r\n- User ratings display\r\n- Settings management\r\n\r\n## Architecture\r\n\r\nThe app follows a clean layered architecture:\r\n\r\n```\r\n┌─────────────────────────────────────────────────────────────┐\r\n│                    Presentation Layer                        │\r\n│  (Screens, Widgets, UI Components)                          │\r\n├─────────────────────────────────────────────────────────────┤\r\n│                      BLoC Layer                              │\r\n│  (Business Logic, State Management)                         │\r\n├─────────────────────────────────────────────────────────────┤\r\n│                    Repository Layer                          │\r\n│  (Data Operations, Business Rules)                          │\r\n├─────────────────────────────────────────────────────────────┤\r\n│                     Services Layer                           │\r\n│  (Firebase, Cloudinary, External APIs)                      │\r\n└─────────────────────────────────────────────────────────────┘\r\n```\r\n\r\n### Key Patterns\r\n- **State Management**: flutter_bloc for reactive state management\r\n- **Dependency Injection**: GetIt for service locator pattern\r\n- **Routing**: go_router for declarative navigation\r\n- **Real-time Data**: Firestore streams for live updates\r\n\r\n## Project Structure\r\n\r\n```\r\nlib/\r\n├── main.dart                 # App entry point\r\n├── app.dart                  # MaterialApp configuration\r\n├── config/\r\n│   ├── di.dart              # Dependency injection setup\r\n│   └── routes.dart          # Route definitions\r\n├── core/\r\n│   ├── constants/\r\n│   │   ├── app_constants.dart\r\n│   │   └── cloudinary_constants.dart\r\n│   ├── services/\r\n│   │   ├── firebase_service.dart\r\n│   │   └── cloudinary_service.dart\r\n│   ├── theme/\r\n│   │   ├── app_colors.dart\r\n│   │   └── app_theme.dart\r\n│   ├── utils/\r\n│   │   └── time_ago.dart\r\n│   └── widgets/\r\n│       ├── cached_image.dart\r\n│       ├── custom_button.dart\r\n│       ├── custom_text_field.dart\r\n│       └── section_header.dart\r\n└── features/\r\n    ├── auth/\r\n    │   ├── bloc/\r\n    │   │   ├── auth_bloc.dart\r\n    │   │   ├── auth_event.dart\r\n    │   │   └── auth_state.dart\r\n    │   ├── data/\r\n    │   │   ├── models/user_model.dart\r\n    │   │   └── repositories/auth_repository.dart\r\n    │   └── presentation/\r\n    │       └── screens/\r\n    │           ├── login_screen.dart\r\n    │           ├── register_screen.dart\r\n    │           ├── forgot_password_screen.dart\r\n    │           ├── onboarding_screen.dart\r\n    │           └── splash_screen.dart\r\n    ├── chat/\r\n    │   ├── bloc/\r\n    │   │   ├── chat_bloc.dart\r\n    │   │   ├── chat_event.dart\r\n    │   │   └── chat_state.dart\r\n    │   ├── data/\r\n    │   │   ├── models/message_model.dart\r\n    │   │   └── repositories/chat_repository.dart\r\n    │   └── presentation/\r\n    │       ├── screens/\r\n    │       │   ├── chat_screen.dart\r\n    │       │   └── conversations_screen.dart\r\n    │       └── widgets/\r\n    │           ├── chat_input.dart\r\n    │           ├── conversation_tile.dart\r\n    │           └── message_bubble.dart\r\n    ├── home/\r\n    │   └── presentation/\r\n    │       ├── screens/\r\n    │       │   ├── home_screen.dart\r\n    │       │   └── search_screen.dart\r\n    │       └── widgets/\r\n    │           └── home_header.dart\r\n    ├── matches/\r\n    │   ├── bloc/\r\n    │   │   ├── match_bloc.dart\r\n    │   │   ├── match_event.dart\r\n    │   │   └── match_state.dart\r\n    │   ├── data/\r\n    │   │   ├── models/match_model.dart\r\n    │   │   └── repositories/match_repository.dart\r\n    │   └── presentation/\r\n    │       ├── screens/\r\n    │       │   ├── matches_screen.dart\r\n    │       │   └── match_details_screen.dart\r\n    │       └── widgets/\r\n    │           ├── match_card.dart\r\n    │           └── match_status_timeline.dart\r\n    ├── notifications/\r\n    │   ├── bloc/\r\n    │   │   ├── notification_bloc.dart\r\n    │   │   ├── notification_event.dart\r\n    │   │   └── notification_state.dart\r\n    │   ├── data/\r\n    │   │   ├── models/notification_model.dart\r\n    │   │   └── repositories/notification_repository.dart\r\n    │   └── presentation/\r\n    │       └── screens/\r\n    │           └── notifications_screen.dart\r\n    ├── profile/\r\n    │   ├── bloc/\r\n    │   │   ├── profile_bloc.dart\r\n    │   │   ├── profile_event.dart\r\n    │   │   └── profile_state.dart\r\n    │   ├── data/\r\n    │   │   └── repositories/profile_repository.dart\r\n    │   └── presentation/\r\n    │       └── screens/\r\n    │           ├── profile_screen.dart\r\n    │           ├── edit_profile_screen.dart\r\n    │           └── settings_screen.dart\r\n    ├── requests/\r\n    │   ├── bloc/\r\n    │   │   ├── request_bloc.dart\r\n    │   │   ├── request_event.dart\r\n    │   │   └── request_state.dart\r\n    │   ├── data/\r\n    │   │   ├── models/request_model.dart\r\n    │   │   └── repositories/request_repository.dart\r\n    │   └── presentation/\r\n    │       ├── screens/\r\n    │       │   ├── requests_list_screen.dart\r\n    │       │   ├── create_request_screen.dart\r\n    │       │   ├── request_details_screen.dart\r\n    │       │   ├── my_requests_screen.dart\r\n    │       │   └── matching_trips_screen.dart\r\n    │       └── widgets/\r\n    │           └── request_card.dart\r\n    └── trips/\r\n        ├── bloc/\r\n        │   ├── trip_bloc.dart\r\n        │   ├── trip_event.dart\r\n        │   └── trip_state.dart\r\n        ├── data/\r\n        │   ├── models/trip_model.dart\r\n        │   └── repositories/trip_repository.dart\r\n        └── presentation/\r\n            ├── screens/\r\n            │   ├── trips_list_screen.dart\r\n            │   ├── create_trip_screen.dart\r\n            │   ├── trip_details_screen.dart\r\n            │   ├── my_trips_screen.dart\r\n            │   └── matching_requests_screen.dart\r\n            └── widgets/\r\n                └── trip_card.dart\r\n```\r\n\r\n## Tech Stack\r\n\r\n### Frontend\r\n- **Flutter** 3.x - Cross-platform UI framework\r\n- **Dart** >=3.2.0 - Programming language\r\n\r\n### State Management & Architecture\r\n- **flutter_bloc** ^8.1.4 - State management\r\n- **equatable** ^2.0.5 - Value equality\r\n- **get_it** ^7.6.7 - Dependency injection\r\n- **go_router** ^13.2.0 - Navigation\r\n\r\n### Backend Services\r\n- **Firebase Auth** ^4.17.0 - Authentication\r\n- **Cloud Firestore** ^4.15.0 - NoSQL database\r\n- **Firebase Messaging** ^14.7.20 - Push notifications\r\n\r\n### Image Handling\r\n- **Cloudinary** - Image hosting (unsigned uploads)\r\n- **image_picker** ^1.0.7 - Image selection\r\n- **image_cropper** ^11.0.0 - Image cropping\r\n- **cached_network_image** ^3.3.1 - Image caching\r\n\r\n### Utilities\r\n- **http** ^1.2.0 - HTTP client\r\n- **intl** ^0.19.0 - Internationalization\r\n- **uuid** ^4.3.3 - UUID generation\r\n- **shared_preferences** ^2.2.2 - Local storage\r\n- **shimmer** ^3.0.0 - Loading effects\r\n\r\n## Getting Started\r\n\r\n### Prerequisites\r\n- Flutter SDK (>=3.2.0)\r\n- Android Studio / Xcode\r\n- Firebase project\r\n- Cloudinary account\r\n\r\n### Installation\r\n\r\n1. Clone the repository:\r\n```bash\r\ngit clone https://github.com/Almichot-1/Diaspora_mb.git\r\ncd Diaspora_mb\r\n```\r\n\r\n2. Install dependencies:\r\n```bash\r\nflutter pub get\r\n```\r\n\r\n3. Configure Firebase:\r\n   - Create a Firebase project\r\n   - Add Android/iOS apps\r\n   - Download `google-services.json` (Android) to `android/app/`\r\n   - Download `GoogleService-Info.plist` (iOS) to `ios/Runner/`\r\n\r\n4. Run the app:\r\n```bash\r\nflutter run\r\n```\r\n\r\n### Build Commands\r\n\r\nDebug APK:\r\n```bash\r\nflutter build apk --debug\r\n```\r\n\r\nRelease APK:\r\n```bash\r\nflutter build apk --release\r\n```\r\n\r\nInstall on device:\r\n```bash\r\nadb install -r build/app/outputs/flutter-apk/app-debug.apk\r\n```\r\n\r\n## Configuration\r\n\r\n### Firebase Setup\r\n\r\nRequired Firebase services:\r\n- **Authentication**: Email/password provider enabled\r\n- **Cloud Firestore**: Database for all app data\r\n- **Firebase Messaging**: Push notifications (optional)\r\n\r\nFirestore security rules should be configured to:\r\n- Allow authenticated users to read/write their own data\r\n- Allow public read access to trips and requests\r\n- Restrict match operations to participants only\r\n\r\n### Cloudinary Setup\r\n\r\n1. Create a Cloudinary account\r\n2. Create an unsigned upload preset named `diaspora_unsigned`\r\n3. Enable dynamic folders in preset settings\r\n\r\nConfigure via dart-define:\r\n```bash\r\nflutter run \\\r\n  --dart-define=CLOUDINARY_CLOUD_NAME=your_cloud_name \\\r\n  --dart-define=CLOUDINARY_UPLOAD_PRESET=your_preset\r\n```\r\n\r\nImage folders:\r\n- Profile images: `diaspora/profiles`\r\n- Chat images: `diaspora/chats`\r\n- Request images: `requests/<requestId>`\r\n\r\n## Database Schema\r\n\r\n### Firestore Collections\r\n\r\n#### users\r\n```javascript\r\n{\r\n  uid: string,\r\n  email: string,\r\n  fullName: string,\r\n  photoUrl: string | null,\r\n  phone: string | null,\r\n  bio: string | null,\r\n  rating: number,\r\n  reviewCount: number,\r\n  tripsCompleted: number,\r\n  requestsCompleted: number,\r\n  createdAt: timestamp,\r\n  updatedAt: timestamp\r\n}\r\n```\r\n\r\n#### trips\r\n```javascript\r\n{\r\n  id: string,\r\n  travelerId: string,\r\n  travelerName: string,\r\n  travelerPhoto: string | null,\r\n  travelerRating: number,\r\n  originCity: string,\r\n  originCountry: string,\r\n  destinationCity: string,\r\n  destinationCountry: string,\r\n  departureDate: timestamp,\r\n  returnDate: timestamp | null,\r\n  availableCapacityKg: number,\r\n  pricePerKg: number | null,\r\n  acceptedItemTypes: string[],\r\n  notes: string | null,\r\n  status: 'active' | 'completed' | 'cancelled',\r\n  matchCount: number,\r\n  createdAt: timestamp,\r\n  updatedAt: timestamp\r\n}\r\n```\r\n\r\n#### requests\r\n```javascript\r\n{\r\n  id: string,\r\n  requesterId: string,\r\n  requesterName: string,\r\n  requesterPhoto: string | null,\r\n  requesterRating: number,\r\n  title: string,\r\n  description: string,\r\n  category: 'documents' | 'electronics' | 'clothing' | 'food' | 'medicine' | 'other',\r\n  weightKg: number,\r\n  imageUrls: string[],\r\n  pickupCity: string,\r\n  pickupCountry: string,\r\n  pickupAddress: string,\r\n  deliveryCity: string,\r\n  deliveryCountry: string,\r\n  deliveryAddress: string,\r\n  recipientName: string,\r\n  recipientPhone: string,\r\n  preferredDeliveryDate: timestamp | null,\r\n  offeredPrice: number | null,\r\n  isUrgent: boolean,\r\n  status: 'active' | 'matched' | 'completed' | 'cancelled',\r\n  matchedTripId: string | null,\r\n  matchedTravelerId: string | null,\r\n  createdAt: timestamp,\r\n  updatedAt: timestamp\r\n}\r\n```\r\n\r\n#### matches\r\n```javascript\r\n{\r\n  id: string,  // Format: {tripId}__{requestId}\r\n  tripId: string,\r\n  requestId: string,\r\n  travelerId: string,\r\n  travelerName: string,\r\n  travelerPhoto: string | null,\r\n  requesterId: string,\r\n  requesterName: string,\r\n  requesterPhoto: string | null,\r\n  itemTitle: string,\r\n  route: string,\r\n  tripDate: timestamp,\r\n  agreedPrice: number | null,\r\n  status: 'pending' | 'accepted' | 'rejected' | 'confirmed' | 'pickedUp' | 'inTransit' | 'delivered' | 'completed' | 'cancelled',\r\n  participants: string[],  // [travelerId, requesterId]\r\n  lastMessage: string | null,\r\n  lastMessageAt: timestamp | null,\r\n  confirmedAt: timestamp | null,\r\n  completedAt: timestamp | null,\r\n  createdAt: timestamp,\r\n  updatedAt: timestamp\r\n}\r\n```\r\n\r\n#### matches/{matchId}/messages (subcollection)\r\n```javascript\r\n{\r\n  id: string,\r\n  matchId: string,\r\n  senderId: string,\r\n  senderName: string,\r\n  content: string,\r\n  type: 'text' | 'image' | 'system',\r\n  imageUrl: string | null,\r\n  isRead: boolean,\r\n  isEdited: boolean,\r\n  editedAt: timestamp | null,\r\n  createdAt: timestamp\r\n}\r\n```\r\n\r\n#### notifications\r\n```javascript\r\n{\r\n  id: string,\r\n  userId: string,\r\n  type: 'matchRequest' | 'matchAccepted' | 'matchRejected' | 'matchConfirmed' | 'newMessage' | 'statusUpdate' | 'system',\r\n  title: string,\r\n  body: string,\r\n  isRead: boolean,\r\n  matchId: string | null,\r\n  tripId: string | null,\r\n  requestId: string | null,\r\n  senderId: string | null,\r\n  senderName: string | null,\r\n  senderPhoto: string | null,\r\n  data: map | null,\r\n  createdAt: timestamp\r\n}\r\n```\r\n\r\n#### reviews\r\n```javascript\r\n{\r\n  id: string,\r\n  matchId: string,\r\n  reviewerId: string,\r\n  revieweeId: string,\r\n  rating: number,  // 1-5\r\n  comment: string | null,\r\n  createdAt: timestamp\r\n}\r\n```\r\n\r\n## Feature Documentation\r\n\r\n### Match Creation Flow\r\n\r\n1. Requester browses trips or views matching trips for their request\r\n2. Requester taps \"Request Match\" on a compatible trip\r\n3. System creates match with status `pending`\r\n4. Traveler receives notification\r\n5. Traveler can accept or reject\r\n6. If accepted, both parties can confirm and chat becomes available\r\n7. Delivery tracking through status updates\r\n\r\n### Chat System\r\n\r\n- Chat is only available for matches with status >= `confirmed`\r\n- Messages support text and images\r\n- Edit/delete available within 12 hours of sending\r\n- System messages auto-generated for status changes\r\n- Real-time updates via Firestore streams\r\n\r\n### Notification System\r\n\r\nNotifications are created automatically when:\r\n- Match request is created (notifies traveler)\r\n- Match is accepted (notifies requester)\r\n- Match is rejected (notifies requester)\r\n- Delivery status changes (notifies both parties)\r\n\r\n## API Reference\r\n\r\n### BLoC Events\r\n\r\n#### AuthBloc\r\n- `AuthCheckRequested` - Check current auth state\r\n- `AuthLoginRequested(email, password)` - Login\r\n- `AuthRegisterRequested(email, password, fullName)` - Register\r\n- `AuthLogoutRequested` - Logout\r\n- `AuthPasswordResetRequested(email)` - Reset password\r\n\r\n#### TripBloc\r\n- `TripsLoadRequested` - Load all active trips\r\n- `MyTripsLoadRequested(userId)` - Load user's trips\r\n- `TripCreateRequested(trip)` - Create trip\r\n- `TripUpdateRequested(trip)` - Update trip\r\n- `TripCancelRequested(tripId)` - Cancel trip\r\n\r\n#### RequestBloc\r\n- `RequestsLoadRequested` - Load all active requests\r\n- `MyRequestsLoadRequested(userId)` - Load user's requests\r\n- `RequestCreateRequested(request, images)` - Create request\r\n- `RequestUpdateRequested(request)` - Update request\r\n- `RequestCancelRequested(requestId)` - Cancel request\r\n\r\n#### MatchBloc\r\n- `MatchesLoadRequested(userId)` - Load user's matches\r\n- `MatchDetailsRequested(matchId)` - Load match details\r\n- `MatchCreateRequested(...)` - Create match\r\n- `MatchAcceptRequested(matchId)` - Accept match\r\n- `MatchRejectRequested(matchId)` - Reject match\r\n- `MatchConfirmRequested(matchId)` - Confirm match\r\n- `MatchStatusUpdateRequested(matchId, status)` - Update status\r\n- `MatchCancelRequested(matchId)` - Cancel match\r\n\r\n#### ChatBloc\r\n- `ChatLoadRequested(matchId)` - Load chat messages\r\n- `ChatSendMessageRequested(matchId, content)` - Send text\r\n- `ChatSendImageRequested(matchId, image)` - Send image\r\n- `ChatEditMessageRequested(matchId, messageId, content)` - Edit message\r\n- `ChatDeleteMessageRequested(matchId, messageId)` - Delete message\r\n- `ChatMarkAsReadRequested(matchId)` - Mark messages read\r\n\r\n#### NotificationBloc\r\n- `NotificationsLoadRequested(userId)` - Load notifications\r\n- `NotificationMarkAsReadRequested(notificationId)` - Mark read\r\n- `NotificationMarkAllAsReadRequested(userId)` - Mark all read\r\n- `NotificationDeleteRequested(notificationId)` - Delete\r\n- `NotificationDeleteAllRequested(userId)` - Delete all\r\n\r\n## Troubleshooting\r\n\r\n### Stale UI after code changes\r\n\r\n```bash\r\nflutter clean\r\nflutter pub get\r\n```\r\n\r\nFull clean (Windows PowerShell):\r\n```powershell\r\nflutter clean\r\nRemove-Item -Recurse -Force .dart_tool, build -ErrorAction SilentlyContinue\r\nRemove-Item -Recurse -Force android\\.gradle, android\\build, android\\app\\build -ErrorAction SilentlyContinue\r\nflutter pub get\r\nflutter build apk --debug\r\n```\r\n\r\nFull clean (macOS/Linux):\r\n```bash\r\nflutter clean\r\nrm -rf .dart_tool build android/.gradle android/build android/app/build\r\nflutter pub get\r\nflutter build apk --debug\r\n```\r\n\r\nReinstall app:\r\n```bash\r\nadb uninstall com.diaspora.delivery.diaspora_delivery\r\nadb install -r build/app/outputs/flutter-apk/app-debug.apk\r\n```\r\n\r\n### Cloudinary uploads not working\r\n\r\n1. Verify cloud name matches your account\r\n2. Ensure upload preset is set to \"unsigned\"\r\n3. Check preset allows dynamic folders\r\n4. Verify network connectivity\r\n\r\n### Firebase errors\r\n\r\n1. Ensure `google-services.json` is in `android/app/`\r\n2. Check Firebase project has required services enabled\r\n3. Verify package name matches Firebase app configuration\r\n\r\n### Chat not available\r\n\r\nChat is only enabled for matches with status `confirmed` or later. Ensure:\r\n1. Match has been accepted by traveler\r\n2. Match has been confirmed by both parties\r\n\r\n## Security Considerations\r\n\r\n### Current MVP Limitations\r\n\r\n1. **Unsigned Cloudinary uploads**: Anyone with the preset can upload. Profile photos use deterministic public_id (user's uid), which could be overwritten by malicious actors.\r\n\r\n2. **Client-side validation**: Most validation happens client-side. Firestore security rules should be properly configured for production.\r\n\r\n3. **Firestore rules currently in test mode**: If your Firestore rules are in \"test mode\" (wide open), any user can read/write data. Tighten rules before sharing the app.\r\n\r\n### Recommended for Production\r\n\r\n1. Move to signed Cloudinary uploads via backend proxy\r\n2. Implement proper Firestore security rules\r\n3. Add rate limiting\r\n4. Implement user verification/KYC\r\n5. Add payment integration with escrow\r\n6. Implement dispute resolution system\r\n\r\n## Contributing\r\n\r\n1. Fork the repository\r\n2. Create a feature branch (`git checkout -b feature/amazing-feature`)\r\n3. Commit changes (`git commit -m 'Add amazing feature'`)\r\n4. Push to branch (`git push origin feature/amazing-feature`)\r\n5. Open a Pull Request\r\n\r\n## License\r\n\r\nThis project is proprietary software. All rights reserved.\r\n\r\n## Contact\r\n\r\nFor questions or support, please contact the development team.\r\n"
        }
    ]
}