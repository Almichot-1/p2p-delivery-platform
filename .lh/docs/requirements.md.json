{
    "sourceFile": "docs/requirements.md",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1767975987724,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1767975987724,
            "name": "Commit-0",
            "content": "# Requirements\r\n\r\n## Scope\r\n- Flutter mobile app for peer-to-peer delivery (Diaspora Delivery).\r\n- Platforms: Android (primary), iOS feasible; backend: Firebase (Auth, Firestore), Cloudinary for images.\r\n\r\n## Functional Requirements\r\n1) Authentication\r\n- Email/password login, register, forgot password.\r\n- Persisted session; logout.\r\n\r\n2) Profile\r\n- View/update profile (name, phone, photo, country).\r\n- Profile photo upload to Cloudinary (unsigned preset). \r\n\r\n3) Trips (Traveler)\r\n- Create trip: origin, destination, departure date, return date (optional), capacity kg, accepted item types, price/kg (optional), notes.\r\n- List/filter trips (destination, date after).\r\n- View trip details; cancel trip.\r\n- My Trips list.\r\n\r\n4) Requests (Requester)\r\n- Create request: title, description, category, weight kg, images (<=5), pickup/delivery addresses, recipient info, preferred delivery date (optional), offered price, urgency flag.\r\n- List/filter requests (delivery city, category).\r\n- View request details; cancel request.\r\n- My Requests list.\r\n\r\n5) Matches (Lifecycle)\r\n- List matches for current user; detail view with timeline/status/actions.\r\n- Status transitions validated in repository:\r\n  - pending → accepted/rejected\r\n  - accepted → confirmed\r\n  - confirmed → pickedUp → inTransit → delivered → completed\r\n  - cancel allowed before delivered\r\n- Role rules: traveler performs pickup/transit/delivery; both can confirm/complete; participants only.\r\n- Agreed price editable while pending/accepted.\r\n\r\n6) Matches (Creation, Phase 6.5)\r\n- From Trip (Traveler flow):\r\n  - Show matching requests filtered by: deliveryCity == trip.destinationCity, request status == active, request weightKg ≤ trip.availableCapacityKg, trip active and upcoming.\r\n  - Action: “I Can Deliver This” → confirm dialog → create match (status pending) → request becomes matched.\r\n- From Request (Requester flow):\r\n  - Show matching trips filtered by: destinationCity == request.deliveryCity, trip status == active, trip upcoming, trip availableCapacityKg ≥ request.weightKg.\r\n  - Action: “Request This Traveler” → confirm dialog → create match (status pending) → request becomes matched.\r\n- Idempotency: one match per (tripId, requestId); duplicates blocked.\r\n- Validation errors shown to user (capacity, date passed, already matched, duplicate).\r\n\r\n7) Navigation\r\n- Tabs: Home, Trips, Requests, Matches, Chat (placeholder), Profile via menu.\r\n- Routes include trip/request create, details, my lists, matches list/detail, matching flows:\r\n  - /trips/:tripId/matching-requests\r\n  - /requests/:requestId/matching-trips\r\n\r\n8) Notifications\r\n- Screen scaffold present; push not wired yet.\r\n\r\n## Non-Functional Requirements\r\n- Maintain analyzer-clean code; bloc + repository layering; no direct Firestore writes from UI.\r\n- DI via GetIt; routing via go_router; state via flutter_bloc + equatable.\r\n- Image hosting via Cloudinary unsigned preset (MVP); note security caveats.\r\n- Build process: flutter build apk --debug; ADB install/launch for on-device tests.\r\n- Stale build mitigation: flutter clean; remove android/.gradle, android/build, android/app/build, build, .dart_tool; then rebuild.\r\n\r\n## Data & Collections (Firestore)\r\n- users\r\n- trips\r\n- requests\r\n- matches\r\n- reviews (placeholder)\r\n- notifications (placeholder)\r\n\r\n### Key Fields\r\n- Trip: travelerId/name/photo, origin/destination, departureDate, availableCapacityKg, pricePerKg, status, matchCount.\r\n- Request: requesterId/name/photo, title, category, weightKg, pickup/delivery, offeredPrice, preferredDeliveryDate, isUrgent, status, matchedTripId, matchedTravelerId, imageUrls.\r\n- Match: tripId, requestId, travelerId/name/photo, requesterId/name/photo, itemTitle, route, tripDate, agreedPrice, status, participants, createdAt/updatedAt, confirmedAt/completedAt.\r\n\r\n## Security & Privacy\r\n- Current Firestore rules (test mode until 2026-02-05) are wide open — must be tightened; suggested: allow only authenticated users; matches readable by participants; trips/requests at least read-only to authed users; writes limited to owners.\r\n- Cloudinary unsigned uploads: preset can be abused; profile image overwrite risk; acceptable for MVP only.\r\n\r\n## Acceptance Criteria (Phase 6.5)\r\n- Traveler can create a match from Trip → Matching Requests with required filters.\r\n- Requester can create a match from Request → Matching Trips with required filters.\r\n- Duplicate (tripId, requestId) creation blocked.\r\n- Request status flips to matched when match created.\r\n- Match appears for both participants with status pending.\r\n- Validation errors are user-visible; no silent failures.\r\n- flutter analyze passes.\r\n"
        }
    ]
}