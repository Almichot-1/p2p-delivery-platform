{
    "sourceFile": "frontend/lib/features/auth/bloc/auth_bloc.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1766327036504,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1766327682547,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,1 +1,181 @@\n+import 'dart:async';\r\n+import 'package:flutter_bloc/flutter_bloc.dart';\r\n+import '../data/repositories/auth_repository.dart';\r\n+import 'auth_event.dart';\r\n+import 'auth_state.dart';\r\n \r\n+class AuthBloc extends Bloc<AuthEvent, AuthState> {\r\n+  final AuthRepository _authRepository;\r\n+  StreamSubscription? _authSubscription;\r\n+\r\n+  AuthBloc(this._authRepository) : super(AuthInitial()) {\r\n+    on<AuthCheckRequested>(_onAuthCheckRequested);\r\n+    on<AuthLoginRequested>(_onLoginRequested);\r\n+    on<AuthRegisterRequested>(_onRegisterRequested);\r\n+    on<AuthPhoneOTPRequested>(_onPhoneOTPRequested);\r\n+    on<AuthPhoneOTPVerified>(_onPhoneOTPVerified);\r\n+    on<AuthForgotPasswordRequested>(_onForgotPasswordRequested);\r\n+    on<AuthLogoutRequested>(_onLogoutRequested);\r\n+    on<AuthUserChanged>(_onUserChanged);\r\n+\r\n+    // Listen to auth state changes\r\n+    _authSubscription = _authRepository.authStateChanges.listen((user) {\r\n+      add(AuthUserChanged());\r\n+    });\r\n+  }\r\n+\r\n+  Future<void> _onAuthCheckRequested(\r\n+    AuthCheckRequested event,\r\n+    Emitter<AuthState> emit,\r\n+  ) async {\r\n+    emit(AuthLoading());\r\n+\r\n+    try {\r\n+      final user = await _authRepository.getCurrentUserData();\r\n+      if (user != null) {\r\n+        emit(AuthAuthenticated(user: user));\r\n+      } else {\r\n+        emit(AuthUnauthenticated());\r\n+      }\r\n+    } catch (e) {\r\n+      emit(AuthUnauthenticated());\r\n+    }\r\n+  }\r\n+\r\n+  Future<void> _onLoginRequested(\r\n+    AuthLoginRequested event,\r\n+    Emitter<AuthState> emit,\r\n+  ) async {\r\n+    emit(AuthLoading());\r\n+\r\n+    try {\r\n+      final user = await _authRepository.loginWithEmail(\r\n+        email: event.email,\r\n+        password: event.password,\r\n+      );\r\n+      emit(AuthAuthenticated(user: user));\r\n+    } catch (e) {\r\n+      emit(AuthError(message: e.toString()));\r\n+    }\r\n+  }\r\n+\r\n+  Future<void> _onRegisterRequested(\r\n+    AuthRegisterRequested event,\r\n+    Emitter<AuthState> emit,\r\n+  ) async {\r\n+    emit(AuthLoading());\r\n+\r\n+    try {\r\n+      final user = await _authRepository.registerWithEmail(\r\n+        email: event.email,\r\n+        password: event.password,\r\n+        fullName: event.fullName,\r\n+        phone: event.phone,\r\n+      );\r\n+      emit(AuthAuthenticated(user: user));\r\n+    } catch (e) {\r\n+      emit(AuthError(message: e.toString()));\r\n+    }\r\n+  }\r\n+\r\n+  Future<void> _onPhoneOTPRequested(\r\n+    AuthPhoneOTPRequested event,\r\n+    Emitter<AuthState> emit,\r\n+  ) async {\r\n+    emit(AuthLoading());\r\n+\r\n+    await _authRepository.sendPhoneOTP(\r\n+      phoneNumber: event.phoneNumber,\r\n+      onCodeSent: (verificationId) {\r\n+        emit(AuthPhoneOTPSent(\r\n+          verificationId: verificationId,\r\n+          phoneNumber: event.phoneNumber,\r\n+        ));\r\n+      },\r\n+      onError: (error) {\r\n+        emit(AuthError(message: error));\r\n+      },\r\n+      onAutoVerify: (credential) async {\r\n+        // Auto verification - sign in directly\r\n+        try {\r\n+          final user = await _authRepository.verifyPhoneOTP(\r\n+            verificationId: '',\r\n+            otp: '',\r\n+            fullName: '',\r\n+          );\r\n+          emit(AuthAuthenticated(user: user));\r\n+        } catch (e) {\r\n+          emit(AuthError(message: e.toString()));\r\n+        }\r\n+      },\r\n+    );\r\n+  }\r\n+\r\n+  Future<void> _onPhoneOTPVerified(\r\n+    AuthPhoneOTPVerified event,\r\n+    Emitter<AuthState> emit,\r\n+  ) async {\r\n+    emit(AuthLoading());\r\n+\r\n+    try {\r\n+      final user = await _authRepository.verifyPhoneOTP(\r\n+        verificationId: event.verificationId,\r\n+        otp: event.otp,\r\n+        fullName: event.fullName,\r\n+      );\r\n+      emit(AuthAuthenticated(user: user));\r\n+    } catch (e) {\r\n+      emit(AuthError(message: e.toString()));\r\n+    }\r\n+  }\r\n+\r\n+  Future<void> _onForgotPasswordRequested(\r\n+    AuthForgotPasswordRequested event,\r\n+    Emitter<AuthState> emit,\r\n+  ) async {\r\n+    emit(AuthLoading());\r\n+\r\n+    try {\r\n+      await _authRepository.sendPasswordResetEmail(event.email);\r\n+      emit(AuthPasswordResetSent(email: event.email));\r\n+    } catch (e) {\r\n+      emit(AuthError(message: e.toString()));\r\n+    }\r\n+  }\r\n+\r\n+  Future<void> _onLogoutRequested(\r\n+    AuthLogoutRequested event,\r\n+    Emitter<AuthState> emit,\r\n+  ) async {\r\n+    emit(AuthLoading());\r\n+\r\n+    try {\r\n+      await _authRepository.logout();\r\n+      emit(AuthUnauthenticated());\r\n+    } catch (e) {\r\n+      emit(AuthError(message: e.toString()));\r\n+    }\r\n+  }\r\n+\r\n+  Future<void> _onUserChanged(\r\n+    AuthUserChanged event,\r\n+    Emitter<AuthState> emit,\r\n+  ) async {\r\n+    try {\r\n+      final user = await _authRepository.getCurrentUserData();\r\n+      if (user != null) {\r\n+        emit(AuthAuthenticated(user: user));\r\n+      } else {\r\n+        emit(AuthUnauthenticated());\r\n+      }\r\n+    } catch (e) {\r\n+      emit(AuthUnauthenticated());\r\n+    }\r\n+  }\r\n+\r\n+  @override\r\n+  Future<void> close() {\r\n+    _authSubscription?.cancel();\r\n+    return super.close();\r\n+  }\r\n+}\n\\ No newline at end of file\n"
                }
            ],
            "date": 1766327036504,
            "name": "Commit-0",
            "content": "\r\n"
        }
    ]
}