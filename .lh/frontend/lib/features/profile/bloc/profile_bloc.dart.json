{
    "sourceFile": "frontend/lib/features/profile/bloc/profile_bloc.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1766327036637,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1766330145419,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,1 +1,99 @@\n+import 'dart:async';\r\n+import 'package:flutter_bloc/flutter_bloc.dart';\r\n+import '../data/repositories/profile_repository.dart';\r\n+import 'profile_event.dart';\r\n+import 'profile_state.dart';\r\n \r\n+class ProfileBloc extends Bloc<ProfileEvent, ProfileState> {\r\n+  final ProfileRepository _profileRepository;\r\n+  StreamSubscription? _profileSubscription;\r\n+\r\n+  ProfileBloc(this._profileRepository) : super(ProfileInitial()) {\r\n+    on<ProfileLoadRequested>(_onProfileLoadRequested);\r\n+    on<ProfileUpdateRequested>(_onProfileUpdateRequested);\r\n+    on<ProfilePhotoUpdateRequested>(_onProfilePhotoUpdateRequested);\r\n+    on<ProfileVerificationRequested>(_onProfileVerificationRequested);\r\n+    on<ProfileRoleUpdateRequested>(_onProfileRoleUpdateRequested);\r\n+  }\r\n+\r\n+  Future<void> _onProfileLoadRequested(\r\n+    ProfileLoadRequested event,\r\n+    Emitter<ProfileState> emit,\r\n+  ) async {\r\n+    emit(ProfileLoading());\r\n+\r\n+    await _profileSubscription?.cancel();\r\n+    _profileSubscription = _profileRepository\r\n+        .getUserProfile(event.userId)\r\n+        .listen(\r\n+      (user) {\r\n+        if (user != null) {\r\n+          emit(ProfileLoaded(user));\r\n+        } else {\r\n+          emit(const ProfileError('User not found'));\r\n+        }\r\n+      },\r\n+      onError: (error) => emit(ProfileError(error.toString())),\r\n+    );\r\n+  }\r\n+\r\n+  Future<void> _onProfileUpdateRequested(\r\n+    ProfileUpdateRequested event,\r\n+    Emitter<ProfileState> emit,\r\n+  ) async {\r\n+    emit(ProfileLoading());\r\n+\r\n+    try {\r\n+      await _profileRepository.updateProfile(event.user);\r\n+      emit(ProfileUpdated());\r\n+      emit(ProfileLoaded(event.user));\r\n+    } catch (e) {\r\n+      emit(ProfileError(e.toString()));\r\n+    }\r\n+  }\r\n+\r\n+  Future<void> _onProfilePhotoUpdateRequested(\r\n+    ProfilePhotoUpdateRequested event,\r\n+    Emitter<ProfileState> emit,\r\n+  ) async {\r\n+    emit(ProfileLoading());\r\n+\r\n+    try {\r\n+      final photoUrl = await _profileRepository.updateProfilePhoto(event.photo);\r\n+      emit(ProfilePhotoUpdated(photoUrl));\r\n+    } catch (e) {\r\n+      emit(ProfileError(e.toString()));\r\n+    }\r\n+  }\r\n+\r\n+  Future<void> _onProfileVerificationRequested(\r\n+    ProfileVerificationRequested event,\r\n+    Emitter<ProfileState> emit,\r\n+  ) async {\r\n+    emit(ProfileLoading());\r\n+\r\n+    try {\r\n+      await _profileRepository.uploadVerificationDocument(event.document);\r\n+      emit(ProfileVerificationSubmitted());\r\n+    } catch (e) {\r\n+      emit(ProfileError(e.toString()));\r\n+    }\r\n+  }\r\n+\r\n+  Future<void> _onProfileRoleUpdateRequested(\r\n+    ProfileRoleUpdateRequested event,\r\n+    Emitter<ProfileState> emit,\r\n+  ) async {\r\n+    try {\r\n+      await _profileRepository.updateUserRole(event.role);\r\n+    } catch (e) {\r\n+      emit(ProfileError(e.toString()));\r\n+    }\r\n+  }\r\n+\r\n+  @override\r\n+  Future<void> close() {\r\n+    _profileSubscription?.cancel();\r\n+    return super.close();\r\n+  }\r\n+}\n\\ No newline at end of file\n"
                }
            ],
            "date": 1766327036637,
            "name": "Commit-0",
            "content": "\r\n"
        }
    ]
}