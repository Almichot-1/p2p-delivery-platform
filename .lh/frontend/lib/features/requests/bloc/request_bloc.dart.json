{
    "sourceFile": "frontend/lib/features/requests/bloc/request_bloc.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1766327062896,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1766328770023,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,1 +1,135 @@\n+import 'dart:async';\r\n+import 'package:flutter_bloc/flutter_bloc.dart';\r\n+import '../data/repositories/request_repository.dart';\r\n+import 'request_event.dart';\r\n+import 'request_state.dart';\r\n \r\n+class RequestBloc extends Bloc<RequestEvent, RequestState> {\r\n+  final RequestRepository _requestRepository;\r\n+  StreamSubscription? _requestsSubscription;\r\n+\r\n+  RequestBloc(this._requestRepository) : super(RequestInitial()) {\r\n+    on<RequestsLoadRequested>(_onRequestsLoadRequested);\r\n+    on<MyRequestsLoadRequested>(_onMyRequestsLoadRequested);\r\n+    on<RequestDetailsRequested>(_onRequestDetailsRequested);\r\n+    on<RequestCreateRequested>(_onRequestCreateRequested);\r\n+    on<RequestUpdateRequested>(_onRequestUpdateRequested);\r\n+    on<RequestCancelRequested>(_onRequestCancelRequested);\r\n+    on<RequestSearchRequested>(_onRequestSearchRequested);\r\n+  }\r\n+\r\n+  Future<void> _onRequestsLoadRequested(\r\n+    RequestsLoadRequested event,\r\n+    Emitter<RequestState> emit,\r\n+  ) async {\r\n+    emit(RequestLoading());\r\n+\r\n+    await _requestsSubscription?.cancel();\r\n+    _requestsSubscription = _requestRepository\r\n+        .getActiveRequests(\r\n+          deliveryCity: event.deliveryCity,\r\n+          category: event.category,\r\n+        )\r\n+        .listen(\r\n+          (requests) => emit(RequestsLoaded(requests)),\r\n+          onError: (error) => emit(RequestError(error.toString())),\r\n+        );\r\n+  }\r\n+\r\n+  Future<void> _onMyRequestsLoadRequested(\r\n+    MyRequestsLoadRequested event,\r\n+    Emitter<RequestState> emit,\r\n+  ) async {\r\n+    emit(RequestLoading());\r\n+    // Implementation similar to trips\r\n+  }\r\n+\r\n+  Future<void> _onRequestDetailsRequested(\r\n+    RequestDetailsRequested event,\r\n+    Emitter<RequestState> emit,\r\n+  ) async {\r\n+    emit(RequestLoading());\r\n+\r\n+    await _requestsSubscription?.cancel();\r\n+    _requestsSubscription =\r\n+        _requestRepository.getRequestById(event.requestId).listen(\r\n+      (request) {\r\n+        if (request != null) {\r\n+          emit(RequestDetailsLoaded(request));\r\n+        } else {\r\n+          emit(const RequestError('Request not found'));\r\n+        }\r\n+      },\r\n+      onError: (error) => emit(RequestError(error.toString())),\r\n+    );\r\n+  }\r\n+\r\n+  Future<void> _onRequestCreateRequested(\r\n+    RequestCreateRequested event,\r\n+    Emitter<RequestState> emit,\r\n+  ) async {\r\n+    emit(RequestLoading());\r\n+\r\n+    try {\r\n+      final requestId = await _requestRepository.createRequest(\r\n+        event.request,\r\n+        images: event.images,\r\n+      );\r\n+      emit(RequestCreated(requestId));\r\n+    } catch (e) {\r\n+      emit(RequestError(e.toString()));\r\n+    }\r\n+  }\r\n+\r\n+  Future<void> _onRequestUpdateRequested(\r\n+    RequestUpdateRequested event,\r\n+    Emitter<RequestState> emit,\r\n+  ) async {\r\n+    emit(RequestLoading());\r\n+\r\n+    try {\r\n+      await _requestRepository.updateRequest(event.request);\r\n+      emit(RequestUpdated());\r\n+    } catch (e) {\r\n+      emit(RequestError(e.toString()));\r\n+    }\r\n+  }\r\n+\r\n+  Future<void> _onRequestCancelRequested(\r\n+    RequestCancelRequested event,\r\n+    Emitter<RequestState> emit,\r\n+  ) async {\r\n+    emit(RequestLoading());\r\n+\r\n+    try {\r\n+      await _requestRepository.cancelRequest(event.requestId);\r\n+      emit(RequestCancelled());\r\n+    } catch (e) {\r\n+      emit(RequestError(e.toString()));\r\n+    }\r\n+  }\r\n+\r\n+  Future<void> _onRequestSearchRequested(\r\n+    RequestSearchRequested event,\r\n+    Emitter<RequestState> emit,\r\n+  ) async {\r\n+    emit(RequestLoading());\r\n+\r\n+    try {\r\n+      final requests = await _requestRepository.searchRequests(\r\n+        deliveryCity: event.deliveryCity,\r\n+        maxWeight: event.maxWeight,\r\n+        category: event.category,\r\n+      );\r\n+      emit(RequestSearchResults(requests));\r\n+    } catch (e) {\r\n+      emit(RequestError(e.toString()));\r\n+    }\r\n+  }\r\n+\r\n+  @override\r\n+  Future<void> close() {\r\n+    _requestsSubscription?.cancel();\r\n+    return super.close();\r\n+  }\r\n+}\n\\ No newline at end of file\n"
                }
            ],
            "date": 1766327062896,
            "name": "Commit-0",
            "content": "\r\n"
        }
    ]
}