{
    "sourceFile": "frontend/lib/features/trips/bloc/trip_bloc.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1766327036647,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1766328195634,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,1 +1,137 @@\n+import 'dart:async';\r\n+import 'package:flutter_bloc/flutter_bloc.dart';\r\n+import '../data/repositories/trip_repository.dart';\r\n+import 'trip_event.dart';\r\n+import 'trip_state.dart';\r\n \r\n+class TripBloc extends Bloc<TripEvent, TripState> {\r\n+  final TripRepository _tripRepository;\r\n+  StreamSubscription? _tripsSubscription;\r\n+\r\n+  TripBloc(this._tripRepository) : super(TripInitial()) {\r\n+    on<TripsLoadRequested>(_onTripsLoadRequested);\r\n+    on<MyTripsLoadRequested>(_onMyTripsLoadRequested);\r\n+    on<TripDetailsRequested>(_onTripDetailsRequested);\r\n+    on<TripCreateRequested>(_onTripCreateRequested);\r\n+    on<TripUpdateRequested>(_onTripUpdateRequested);\r\n+    on<TripCancelRequested>(_onTripCancelRequested);\r\n+    on<TripSearchRequested>(_onTripSearchRequested);\r\n+  }\r\n+\r\n+  Future<void> _onTripsLoadRequested(\r\n+    TripsLoadRequested event,\r\n+    Emitter<TripState> emit,\r\n+  ) async {\r\n+    emit(TripLoading());\r\n+\r\n+    await _tripsSubscription?.cancel();\r\n+    _tripsSubscription = _tripRepository\r\n+        .getActiveTrips(\r\n+          destinationCity: event.destinationCity,\r\n+          afterDate: event.afterDate,\r\n+        )\r\n+        .listen(\r\n+          (trips) => emit(TripsLoaded(trips)),\r\n+          onError: (error) => emit(TripError(error.toString())),\r\n+        );\r\n+  }\r\n+\r\n+  Future<void> _onMyTripsLoadRequested(\r\n+    MyTripsLoadRequested event,\r\n+    Emitter<TripState> emit,\r\n+  ) async {\r\n+    emit(TripLoading());\r\n+\r\n+    // Get current user ID from auth\r\n+    // For now, we'll assume it's passed or available\r\n+    // final userId = _authRepository.currentUserId;\r\n+    \r\n+    await _tripsSubscription?.cancel();\r\n+    // _tripsSubscription = _tripRepository.getTripsByTraveler(userId).listen(...)\r\n+  }\r\n+\r\n+  Future<void> _onTripDetailsRequested(\r\n+    TripDetailsRequested event,\r\n+    Emitter<TripState> emit,\r\n+  ) async {\r\n+    emit(TripLoading());\r\n+\r\n+    await _tripsSubscription?.cancel();\r\n+    _tripsSubscription = _tripRepository.getTripById(event.tripId).listen(\r\n+      (trip) {\r\n+        if (trip != null) {\r\n+          emit(TripDetailsLoaded(trip));\r\n+        } else {\r\n+          emit(const TripError('Trip not found'));\r\n+        }\r\n+      },\r\n+      onError: (error) => emit(TripError(error.toString())),\r\n+    );\r\n+  }\r\n+\r\n+  Future<void> _onTripCreateRequested(\r\n+    TripCreateRequested event,\r\n+    Emitter<TripState> emit,\r\n+  ) async {\r\n+    emit(TripLoading());\r\n+\r\n+    try {\r\n+      final tripId = await _tripRepository.createTrip(event.trip);\r\n+      emit(TripCreated(tripId));\r\n+    } catch (e) {\r\n+      emit(TripError(e.toString()));\r\n+    }\r\n+  }\r\n+\r\n+  Future<void> _onTripUpdateRequested(\r\n+    TripUpdateRequested event,\r\n+    Emitter<TripState> emit,\r\n+  ) async {\r\n+    emit(TripLoading());\r\n+\r\n+    try {\r\n+      await _tripRepository.updateTrip(event.trip);\r\n+      emit(TripUpdated());\r\n+    } catch (e) {\r\n+      emit(TripError(e.toString()));\r\n+    }\r\n+  }\r\n+\r\n+  Future<void> _onTripCancelRequested(\r\n+    TripCancelRequested event,\r\n+    Emitter<TripState> emit,\r\n+  ) async {\r\n+    emit(TripLoading());\r\n+\r\n+    try {\r\n+      await _tripRepository.cancelTrip(event.tripId);\r\n+      emit(TripCancelled());\r\n+    } catch (e) {\r\n+      emit(TripError(e.toString()));\r\n+    }\r\n+  }\r\n+\r\n+  Future<void> _onTripSearchRequested(\r\n+    TripSearchRequested event,\r\n+    Emitter<TripState> emit,\r\n+  ) async {\r\n+    emit(TripLoading());\r\n+\r\n+    try {\r\n+      final trips = await _tripRepository.searchTrips(\r\n+        destinationCity: event.destinationCity,\r\n+        departureDate: event.departureDate,\r\n+        minCapacity: event.minCapacity,\r\n+      );\r\n+      emit(TripSearchResults(trips));\r\n+    } catch (e) {\r\n+      emit(TripError(e.toString()));\r\n+    }\r\n+  }\r\n+\r\n+  @override\r\n+  Future<void> close() {\r\n+    _tripsSubscription?.cancel();\r\n+    return super.close();\r\n+  }\r\n+}\n\\ No newline at end of file\n"
                }
            ],
            "date": 1766327036647,
            "name": "Commit-0",
            "content": "\r\n"
        }
    ]
}