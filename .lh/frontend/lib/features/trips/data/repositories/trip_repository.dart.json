{
    "sourceFile": "frontend/lib/features/trips/data/repositories/trip_repository.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1766327036646,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1766328167508,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,1 +1,115 @@\n+import 'package:cloud_firestore/cloud_firestore.dart';\r\n+import '../../../../core/services/firebase_service.dart';\r\n+import '../../../../core/constants/firebase_constants.dart';\r\n+import '../models/trip_model.dart';\r\n \r\n+class TripRepository {\r\n+  final FirebaseService _firebaseService;\r\n+\r\n+  TripRepository(this._firebaseService);\r\n+\r\n+  // Get all active trips\r\n+  Stream<List<TripModel>> getActiveTrips({\r\n+    String? destinationCity,\r\n+    DateTime? afterDate,\r\n+    int limit = 20,\r\n+  }) {\r\n+    Query query = _firebaseService.tripsCollection\r\n+        .where('status', isEqualTo: TripStatus.active.name)\r\n+        .where('departureDate', isGreaterThan: Timestamp.fromDate(DateTime.now()));\r\n+\r\n+    if (destinationCity != null) {\r\n+      query = query.where('destinationCity', isEqualTo: destinationCity);\r\n+    }\r\n+\r\n+    query = query.orderBy('departureDate').limit(limit);\r\n+\r\n+    return query.snapshots().map((snapshot) =>\r\n+        snapshot.docs.map((doc) => TripModel.fromFirestore(doc)).toList());\r\n+  }\r\n+\r\n+  // Get trips by traveler\r\n+  Stream<List<TripModel>> getTripsByTraveler(String travelerId) {\r\n+    return _firebaseService.tripsCollection\r\n+        .where('travelerId', isEqualTo: travelerId)\r\n+        .orderBy('createdAt', descending: true)\r\n+        .snapshots()\r\n+        .map((snapshot) =>\r\n+            snapshot.docs.map((doc) => TripModel.fromFirestore(doc)).toList());\r\n+  }\r\n+\r\n+  // Get single trip\r\n+  Stream<TripModel?> getTripById(String tripId) {\r\n+    return _firebaseService.tripsCollection\r\n+        .doc(tripId)\r\n+        .snapshots()\r\n+        .map((doc) => doc.exists ? TripModel.fromFirestore(doc) : null);\r\n+  }\r\n+\r\n+  // Create trip\r\n+  Future<String> createTrip(TripModel trip) async {\r\n+    final docRef = await _firebaseService.tripsCollection.add(trip.toFirestore());\r\n+    return docRef.id;\r\n+  }\r\n+\r\n+  // Update trip\r\n+  Future<void> updateTrip(TripModel trip) async {\r\n+    await _firebaseService.tripsCollection\r\n+        .doc(trip.id)\r\n+        .update(trip.toFirestore());\r\n+  }\r\n+\r\n+  // Cancel trip\r\n+  Future<void> cancelTrip(String tripId) async {\r\n+    await _firebaseService.tripsCollection.doc(tripId).update({\r\n+      'status': TripStatus.cancelled.name,\r\n+      'updatedAt': FieldValue.serverTimestamp(),\r\n+    });\r\n+  }\r\n+\r\n+  // Complete trip\r\n+  Future<void> completeTrip(String tripId) async {\r\n+    await _firebaseService.tripsCollection.doc(tripId).update({\r\n+      'status': TripStatus.completed.name,\r\n+      'updatedAt': FieldValue.serverTimestamp(),\r\n+    });\r\n+  }\r\n+\r\n+  // Search trips\r\n+  Future<List<TripModel>> searchTrips({\r\n+    required String destinationCity,\r\n+    DateTime? departureDate,\r\n+    double? minCapacity,\r\n+  }) async {\r\n+    Query query = _firebaseService.tripsCollection\r\n+        .where('status', isEqualTo: TripStatus.active.name)\r\n+        .where('destinationCity', isEqualTo: destinationCity);\r\n+\r\n+    if (departureDate != null) {\r\n+      final startOfDay = DateTime(\r\n+        departureDate.year,\r\n+        departureDate.month,\r\n+        departureDate.day,\r\n+      );\r\n+      final endOfDay = startOfDay.add(const Duration(days: 1));\r\n+\r\n+      query = query\r\n+          .where('departureDate', isGreaterThanOrEqualTo: Timestamp.fromDate(startOfDay))\r\n+          .where('departureDate', isLessThan: Timestamp.fromDate(endOfDay));\r\n+    }\r\n+\r\n+    final snapshot = await query.get();\r\n+    var trips = snapshot.docs.map((doc) => TripModel.fromFirestore(doc)).toList();\r\n+\r\n+    if (minCapacity != null) {\r\n+      trips = trips.where((t) => t.availableCapacityKg >= minCapacity).toList();\r\n+    }\r\n+\r\n+    return trips;\r\n+  }\r\n+\r\n+  // Delete trip\r\n+  Future<void> deleteTrip(String tripId) async {\r\n+    await _firebaseService.tripsCollection.doc(tripId).delete();\r\n+  }\r\n+}\n\\ No newline at end of file\n"
                }
            ],
            "date": 1766327036646,
            "name": "Commit-0",
            "content": "\r\n"
        }
    ]
}