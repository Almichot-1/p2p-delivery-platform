{
    "sourceFile": "frontend/lib/features/matches/bloc/match_bloc.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1766327121721,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1766328906112,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,1 +1,120 @@\n+import 'dart:async';\r\n+import 'package:flutter_bloc/flutter_bloc.dart';\r\n+import '../data/repositories/match_repository.dart';\r\n+import '../data/models/match_model.dart';\r\n+import 'match_event.dart';\r\n+import 'match_state.dart';\r\n \r\n+class MatchBloc extends Bloc<MatchEvent, MatchState> {\r\n+  final MatchRepository _matchRepository;\r\n+  StreamSubscription? _matchesSubscription;\r\n+\r\n+  MatchBloc(this._matchRepository) : super(MatchInitial()) {\r\n+    on<MatchesLoadRequested>(_onMatchesLoadRequested);\r\n+    on<MatchDetailsRequested>(_onMatchDetailsRequested);\r\n+    on<MatchAcceptRequested>(_onMatchAcceptRequested);\r\n+    on<MatchRejectRequested>(_onMatchRejectRequested);\r\n+    on<MatchConfirmRequested>(_onMatchConfirmRequested);\r\n+    on<MatchStatusUpdateRequested>(_onMatchStatusUpdateRequested);\r\n+    on<MatchCancelRequested>(_onMatchCancelRequested);\r\n+  }\r\n+\r\n+  Future<void> _onMatchesLoadRequested(\r\n+    MatchesLoadRequested event,\r\n+    Emitter<MatchState> emit,\r\n+  ) async {\r\n+    emit(MatchLoading());\r\n+\r\n+    await _matchesSubscription?.cancel();\r\n+    _matchesSubscription =\r\n+        _matchRepository.getUserMatches(event.userId).listen(\r\n+              (matches) => emit(MatchesLoaded(matches)),\r\n+              onError: (error) => emit(MatchError(error.toString())),\r\n+            );\r\n+  }\r\n+\r\n+  Future<void> _onMatchDetailsRequested(\r\n+    MatchDetailsRequested event,\r\n+    Emitter<MatchState> emit,\r\n+  ) async {\r\n+    emit(MatchLoading());\r\n+\r\n+    await _matchesSubscription?.cancel();\r\n+    _matchesSubscription = _matchRepository.getMatchById(event.matchId).listen(\r\n+      (match) {\r\n+        if (match != null) {\r\n+          emit(MatchDetailsLoaded(match));\r\n+        } else {\r\n+          emit(const MatchError('Match not found'));\r\n+        }\r\n+      },\r\n+      onError: (error) => emit(MatchError(error.toString())),\r\n+    );\r\n+  }\r\n+\r\n+  Future<void> _onMatchAcceptRequested(\r\n+    MatchAcceptRequested event,\r\n+    Emitter<MatchState> emit,\r\n+  ) async {\r\n+    try {\r\n+      await _matchRepository.acceptMatch(event.matchId);\r\n+      emit(MatchActionSuccess('Match accepted'));\r\n+    } catch (e) {\r\n+      emit(MatchError(e.toString()));\r\n+    }\r\n+  }\r\n+\r\n+  Future<void> _onMatchRejectRequested(\r\n+    MatchRejectRequested event,\r\n+    Emitter<MatchState> emit,\r\n+  ) async {\r\n+    try {\r\n+      await _matchRepository.rejectMatch(event.matchId);\r\n+      emit(MatchActionSuccess('Match rejected'));\r\n+    } catch (e) {\r\n+      emit(MatchError(e.toString()));\r\n+    }\r\n+  }\r\n+\r\n+  Future<void> _onMatchConfirmRequested(\r\n+    MatchConfirmRequested event,\r\n+    Emitter<MatchState> emit,\r\n+  ) async {\r\n+    try {\r\n+      await _matchRepository.confirmMatch(event.matchId);\r\n+      emit(MatchActionSuccess('Match confirmed'));\r\n+    } catch (e) {\r\n+      emit(MatchError(e.toString()));\r\n+    }\r\n+  }\r\n+\r\n+  Future<void> _onMatchStatusUpdateRequested(\r\n+    MatchStatusUpdateRequested event,\r\n+    Emitter<MatchState> emit,\r\n+  ) async {\r\n+    try {\r\n+      await _matchRepository.updateMatchStatus(event.matchId, event.status);\r\n+      emit(MatchActionSuccess('Status updated'));\r\n+    } catch (e) {\r\n+      emit(MatchError(e.toString()));\r\n+    }\r\n+  }\r\n+\r\n+  Future<void> _onMatchCancelRequested(\r\n+    MatchCancelRequested event,\r\n+    Emitter<MatchState> emit,\r\n+  ) async {\r\n+    try {\r\n+      await _matchRepository.cancelMatch(event.matchId);\r\n+      emit(MatchActionSuccess('Match cancelled'));\r\n+    } catch (e) {\r\n+      emit(MatchError(e.toString()));\r\n+    }\r\n+  }\r\n+\r\n+  @override\r\n+  Future<void> close() {\r\n+    _matchesSubscription?.cancel();\r\n+    return super.close();\r\n+  }\r\n+}\n\\ No newline at end of file\n"
                }
            ],
            "date": 1766327121721,
            "name": "Commit-0",
            "content": "\r\n"
        }
    ]
}