{
    "sourceFile": "frontend/lib/features/reviews/bloc/review_bloc.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1766327185975,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1766329275168,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,1 +1,66 @@\n+import 'dart:async';\r\n+import 'package:flutter_bloc/flutter_bloc.dart';\r\n+import '../data/repositories/review_repository.dart';\r\n+import '../data/models/review_model.dart';\r\n+import 'review_event.dart';\r\n+import 'review_state.dart';\r\n \r\n+class ReviewBloc extends Bloc<ReviewEvent, ReviewState> {\r\n+  final ReviewRepository _reviewRepository;\r\n+  StreamSubscription? _reviewsSubscription;\r\n+\r\n+  ReviewBloc(this._reviewRepository) : super(ReviewInitial()) {\r\n+    on<ReviewsLoadRequested>(_onReviewsLoadRequested);\r\n+    on<ReviewCreateRequested>(_onReviewCreateRequested);\r\n+    on<ReviewCheckRequested>(_onReviewCheckRequested);\r\n+  }\r\n+\r\n+  Future<void> _onReviewsLoadRequested(\r\n+    ReviewsLoadRequested event,\r\n+    Emitter<ReviewState> emit,\r\n+  ) async {\r\n+    emit(ReviewLoading());\r\n+\r\n+    await _reviewsSubscription?.cancel();\r\n+    _reviewsSubscription =\r\n+        _reviewRepository.getUserReviews(event.userId).listen(\r\n+              (reviews) => emit(ReviewsLoaded(reviews)),\r\n+              onError: (error) => emit(ReviewError(error.toString())),\r\n+            );\r\n+  }\r\n+\r\n+  Future<void> _onReviewCreateRequested(\r\n+    ReviewCreateRequested event,\r\n+    Emitter<ReviewState> emit,\r\n+  ) async {\r\n+    emit(ReviewLoading());\r\n+\r\n+    try {\r\n+      await _reviewRepository.createReview(event.review);\r\n+      emit(ReviewCreated());\r\n+    } catch (e) {\r\n+      emit(ReviewError(e.toString()));\r\n+    }\r\n+  }\r\n+\r\n+  Future<void> _onReviewCheckRequested(\r\n+    ReviewCheckRequested event,\r\n+    Emitter<ReviewState> emit,\r\n+  ) async {\r\n+    try {\r\n+      final hasReviewed = await _reviewRepository.hasReviewed(\r\n+        event.matchId,\r\n+        event.reviewerId,\r\n+      );\r\n+      emit(ReviewCheckResult(hasReviewed));\r\n+    } catch (e) {\r\n+      emit(ReviewError(e.toString()));\r\n+    }\r\n+  }\r\n+\r\n+  @override\r\n+  Future<void> close() {\r\n+    _reviewsSubscription?.cancel();\r\n+    return super.close();\r\n+  }\r\n+}\n\\ No newline at end of file\n"
                }
            ],
            "date": 1766327185975,
            "name": "Commit-0",
            "content": "\r\n"
        }
    ]
}