{
    "sourceFile": "frontend/lib/features/reviews/presentation/screens/create_review_screen.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1766327185976,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1766329313501,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,1 +1,186 @@\n+import 'package:flutter/material.dart';\r\n+import 'package:flutter_bloc/flutter_bloc.dart';\r\n+import 'package:go_router/go_router.dart';\r\n \r\n+import '../../../../config/dependency_injection.dart';\r\n+import '../../../../core/theme/app_colors.dart';\r\n+import '../../../../core/theme/app_text_styles.dart';\r\n+import '../../../../core/utils/helpers.dart';\r\n+import '../../../../core/widgets/custom_button.dart';\r\n+import '../../../../core/widgets/custom_text_field.dart';\r\n+import '../../../../core/widgets/rating_stars.dart';\r\n+import '../../../../core/widgets/user_avatar.dart';\r\n+import '../../../auth/bloc/auth_bloc.dart';\r\n+import '../../../auth/bloc/auth_state.dart';\r\n+import '../../../matches/bloc/match_bloc.dart';\r\n+import '../../../matches/bloc/match_event.dart';\r\n+import '../../../matches/bloc/match_state.dart';\r\n+import '../../bloc/review_bloc.dart';\r\n+import '../../bloc/review_event.dart';\r\n+import '../../bloc/review_state.dart';\r\n+import '../../data/models/review_model.dart';\r\n+\r\n+class CreateReviewScreen extends StatefulWidget {\r\n+  final String matchId;\r\n+\r\n+  const CreateReviewScreen({super.key, required this.matchId});\r\n+\r\n+  @override\r\n+  State<CreateReviewScreen> createState() => _CreateReviewScreenState();\r\n+}\r\n+\r\n+class _CreateReviewScreenState extends State<CreateReviewScreen> {\r\n+  final _commentController = TextEditingController();\r\n+  double _rating = 0;\r\n+\r\n+  @override\r\n+  void dispose() {\r\n+    _commentController.dispose();\r\n+    super.dispose();\r\n+  }\r\n+\r\n+  @override\r\n+  Widget build(BuildContext context) {\r\n+    return MultiBlocProvider(\r\n+      providers: [\r\n+        BlocProvider(\r\n+          create: (_) =>\r\n+              getIt<MatchBloc>()..add(MatchDetailsRequested(widget.matchId)),\r\n+        ),\r\n+        BlocProvider(create: (_) => getIt<ReviewBloc>()),\r\n+      ],\r\n+      child: BlocListener<ReviewBloc, ReviewState>(\r\n+        listener: (context, state) {\r\n+          if (state is ReviewCreated) {\r\n+            Helpers.showSuccessSnackBar(context, 'Review submitted!');\r\n+            context.pop();\r\n+          } else if (state is ReviewError) {\r\n+            Helpers.showErrorSnackBar(context, state.message);\r\n+          }\r\n+        },\r\n+        child: Scaffold(\r\n+          appBar: AppBar(\r\n+            title: const Text('Leave a Review'),\r\n+          ),\r\n+          body: BlocBuilder<MatchBloc, MatchState>(\r\n+            builder: (context, state) {\r\n+              if (state is MatchDetailsLoaded) {\r\n+                return _buildContent(context, state.match);\r\n+              }\r\n+              return const Center(child: CircularProgressIndicator());\r\n+            },\r\n+          ),\r\n+        ),\r\n+      ),\r\n+    );\r\n+  }\r\n+\r\n+  Widget _buildContent(BuildContext context, match) {\r\n+    final authState = context.read<AuthBloc>().state;\r\n+    if (authState is! AuthAuthenticated) return const SizedBox.shrink();\r\n+\r\n+    final currentUserId = authState.user.uid;\r\n+    final otherName = match.getOtherParticipantName(currentUserId);\r\n+    final otherPhoto = match.getOtherParticipantPhoto(currentUserId);\r\n+    final isTraveler = currentUserId == match.travelerId;\r\n+\r\n+    return SingleChildScrollView(\r\n+      padding: const EdgeInsets.all(24),\r\n+      child: Column(\r\n+        crossAxisAlignment: CrossAxisAlignment.center,\r\n+        children: [\r\n+          // User being reviewed\r\n+          UserAvatar(\r\n+            imageUrl: otherPhoto,\r\n+            name: otherName,\r\n+            size: 80,\r\n+          ),\r\n+          const SizedBox(height: 16),\r\n+          Text(otherName, style: AppTextStyles.h4),\r\n+          Text(\r\n+            isTraveler ? 'Requester' : 'Traveler',\r\n+            style: AppTextStyles.bodyMedium.copyWith(color: AppColors.grey600),\r\n+          ),\r\n+          const SizedBox(height: 8),\r\n+          Text(\r\n+            match.itemTitle,\r\n+            style: AppTextStyles.bodySmall.copyWith(color: AppColors.grey500),\r\n+          ),\r\n+          const SizedBox(height: 32),\r\n+\r\n+          // Rating\r\n+          Text('How was your experience?', style: AppTextStyles.h6),\r\n+          const SizedBox(height: 16),\r\n+          InteractiveRatingStars(\r\n+            rating: _rating,\r\n+            onRatingChanged: (rating) {\r\n+              setState(() => _rating = rating);\r\n+            },\r\n+            size: 48,\r\n+          ),\r\n+          const SizedBox(height: 8),\r\n+          Text(\r\n+            _getRatingText(_rating),\r\n+            style: AppTextStyles.bodyMedium.copyWith(\r\n+              color: AppColors.secondary,\r\n+              fontWeight: FontWeight.w600,\r\n+            ),\r\n+          ),\r\n+          const SizedBox(height: 32),\r\n+\r\n+          // Comment\r\n+          CustomTextField(\r\n+            label: 'Write a review (optional)',\r\n+            hint: 'Share your experience...',\r\n+            controller: _commentController,\r\n+            maxLines: 4,\r\n+          ),\r\n+          const SizedBox(height: 32),\r\n+\r\n+          // Submit button\r\n+          BlocBuilder<ReviewBloc, ReviewState>(\r\n+            builder: (context, state) {\r\n+              return CustomButton(\r\n+                text: 'Submit Review',\r\n+                onPressed: _rating > 0\r\n+                    ? () => _submitReview(context, match, authState.user)\r\n+                    : null,\r\n+                isLoading: state is ReviewLoading,\r\n+              );\r\n+            },\r\n+          ),\r\n+        ],\r\n+      ),\r\n+    );\r\n+  }\r\n+\r\n+  String _getRatingText(double rating) {\r\n+    if (rating == 0) return 'Tap to rate';\r\n+    if (rating <= 1) return 'Poor';\r\n+    if (rating <= 2) return 'Fair';\r\n+    if (rating <= 3) return 'Good';\r\n+    if (rating <= 4) return 'Very Good';\r\n+    return 'Excellent!';\r\n+  }\r\n+\r\n+  void _submitReview(BuildContext context, match, user) {\r\n+    final currentUserId = user.uid;\r\n+    final isTraveler = currentUserId == match.travelerId;\r\n+\r\n+    final review = ReviewModel(\r\n+      id: '',\r\n+      matchId: match.id,\r\n+      reviewerId: currentUserId,\r\n+      reviewerName: user.fullName,\r\n+      reviewerPhoto: user.photoUrl,\r\n+      revieweeId: isTraveler ? match.requesterId : match.travelerId,\r\n+      revieweeName: isTraveler ? match.requesterName : match.travelerName,\r\n+      rating: _rating,\r\n+      comment: _commentController.text.trim(),\r\n+      isTravelerReview: !isTraveler,\r\n+      createdAt: DateTime.now(),\r\n+    );\r\n+\r\n+    context.read<ReviewBloc>().add(ReviewCreateRequested(review));\r\n+  }\r\n+}\n\\ No newline at end of file\n"
                }
            ],
            "date": 1766327185976,
            "name": "Commit-0",
            "content": "\r\n"
        }
    ]
}