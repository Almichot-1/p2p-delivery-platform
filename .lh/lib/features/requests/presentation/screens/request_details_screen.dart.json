{
    "sourceFile": "lib/features/requests/presentation/screens/request_details_screen.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1768061206348,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1768061344866,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,506 @@\n+import 'package:flutter/material.dart';\r\n+import 'package:flutter_bloc/flutter_bloc.dart';\r\n+import 'package:get_it/get_it.dart';\r\n+import 'package:go_router/go_router.dart';\r\n+import 'package:intl/intl.dart';\r\n+\r\n+import '../../../../config/routes.dart';\r\n+import '../../../../core/widgets/cached_image.dart';\r\n+import '../../../auth/bloc/auth_bloc.dart';\r\n+import '../../../auth/bloc/auth_state.dart';\r\n+import '../../bloc/request_bloc.dart';\r\n+import '../../bloc/request_event.dart';\r\n+import '../../bloc/request_state.dart';\r\n+import '../../data/models/request_model.dart';\r\n+import '../widgets/image_carousel.dart';\r\n+\r\n+class RequestDetailsScreen extends StatelessWidget {\r\n+  const RequestDetailsScreen({\r\n+    super.key,\r\n+    required this.requestId,\r\n+  });\r\n+\r\n+  final String requestId;\r\n+\r\n+  @override\r\n+  Widget build(BuildContext context) {\r\n+    return BlocProvider<RequestBloc>(\r\n+      create: (_) => GetIt.instance<RequestBloc>()\r\n+        ..add(RequestDetailsRequested(requestId)),\r\n+      child: BlocConsumer<RequestBloc, RequestState>(\r\n+        listenWhen: (_, s) => s is RequestError || s is RequestCancelled,\r\n+        listener: (context, state) {\r\n+          if (state is RequestError) {\r\n+            ScaffoldMessenger.of(context)\r\n+                .showSnackBar(SnackBar(content: Text(state.message)));\r\n+          }\r\n+          if (state is RequestCancelled) {\r\n+            ScaffoldMessenger.of(context).showSnackBar(\r\n+              const SnackBar(content: Text('Request cancelled')),\r\n+            );\r\n+          }\r\n+        },\r\n+        builder: (context, state) {\r\n+          final request = state is RequestDetailsLoaded ? state.request : null;\r\n+\r\n+          return Scaffold(\r\n+            appBar: AppBar(\r\n+              title: const Text('Request Details'),\r\n+              actions: [\r\n+                if (request != null) _buildOwnerActions(context, request),\r\n+              ],\r\n+            ),\r\n+            body: switch (state) {\r\n+              RequestLoading() =>\r\n+                const Center(child: CircularProgressIndicator()),\r\n+              RequestError() => Center(child: Text(state.message)),\r\n+              RequestDetailsLoaded() =>\r\n+                _RequestDetailsBody(request: state.request),\r\n+              _ => const Center(child: CircularProgressIndicator()),\r\n+            },\r\n+          );\r\n+        },\r\n+      ),\r\n+    );\r\n+  }\r\n+\r\n+  Widget _buildOwnerActions(BuildContext context, RequestModel request) {\r\n+    final authState = context.read<AuthBloc>().state;\r\n+    final isOwner = authState is AuthAuthenticated &&\r\n+        authState.user.uid == request.requesterId;\r\n+\r\n+    if (!isOwner) return const SizedBox.shrink();\r\n+\r\n+    return PopupMenuButton<String>(\r\n+      onSelected: (v) {\r\n+        if (v == 'edit') {\r\n+          context.push(RoutePaths.requestsCreate, extra: request);\r\n+          return;\r\n+        }\r\n+        if (v == 'cancel') {\r\n+          context.read<RequestBloc>().add(RequestCancelRequested(request.id));\r\n+        }\r\n+      },\r\n+      itemBuilder: (context) {\r\n+        return <PopupMenuEntry<String>>[\r\n+          const PopupMenuItem<String>(\r\n+            value: 'edit',\r\n+            child: Text('Edit'),\r\n+          ),\r\n+          if (request.status == RequestStatus.active)\r\n+            const PopupMenuItem<String>(\r\n+              value: 'cancel',\r\n+              child: Text('Cancel'),\r\n+            ),\r\n+        ];\r\n+      },\r\n+    );\r\n+  }\r\n+}\r\n+\r\n+class _RequestDetailsBody extends StatelessWidget {\r\n+  const _RequestDetailsBody({required this.request});\r\n+\r\n+  final RequestModel request;\r\n+\r\n+  @override\r\n+  Widget build(BuildContext context) {\r\n+    final theme = Theme.of(context);\r\n+    final scheme = theme.colorScheme;\r\n+\r\n+    final authState = context.read<AuthBloc>().state;\r\n+    final isOwner = authState is AuthAuthenticated &&\r\n+        authState.user.uid == request.requesterId;\r\n+\r\n+    final dateFmt = DateFormat('MMM d, y');\r\n+\r\n+    return ListView(\r\n+      padding: EdgeInsets.zero,\r\n+      children: [\r\n+        if (request.imageUrls.isNotEmpty)\r\n+          ImageCarousel(urls: request.imageUrls)\r\n+        else\r\n+          Container(\r\n+            height: 240,\r\n+            color: scheme.surfaceContainerHighest,\r\n+            alignment: Alignment.center,\r\n+            child: Icon(Icons.image_not_supported_outlined, color: scheme.onSurfaceVariant),\r\n+          ),\r\n+        Padding(\r\n+          padding: const EdgeInsets.fromLTRB(16, 16, 16, 24),\r\n+          child: Column(\r\n+            crossAxisAlignment: CrossAxisAlignment.start,\r\n+            children: [\r\n+              Row(\r\n+                crossAxisAlignment: CrossAxisAlignment.start,\r\n+                children: [\r\n+                  Expanded(\r\n+                    child: Text(\r\n+                      request.title,\r\n+                      style: theme.textTheme.headlineSmall?.copyWith(fontWeight: FontWeight.w700),\r\n+                    ),\r\n+                  ),\r\n+                  const SizedBox(width: 10),\r\n+                  _StatusBadge(status: request.status),\r\n+                ],\r\n+              ),\r\n+              const SizedBox(height: 10),\r\n+              Wrap(\r\n+                spacing: 8,\r\n+                runSpacing: 8,\r\n+                children: [\r\n+                  _MetaChip(text: request.categoryDisplay, icon: Icons.category_outlined),\r\n+                  _MetaChip(\r\n+                    text: '${request.weightKg.toStringAsFixed(1)} kg',\r\n+                    icon: Icons.scale_outlined,\r\n+                  ),\r\n+                  if (request.isUrgent)\r\n+                    _MetaChip(\r\n+                      text: 'Urgent',\r\n+                      icon: Icons.bolt,\r\n+                      emphasize: true,\r\n+                    ),\r\n+                  if (request.offeredPrice != null)\r\n+                    _MetaChip(\r\n+                      text: '${request.offeredPrice!.toStringAsFixed(2)}',\r\n+                      icon: Icons.payments_outlined,\r\n+                    ),\r\n+                  if (request.preferredDeliveryDate != null)\r\n+                    _MetaChip(\r\n+                      text: dateFmt.format(request.preferredDeliveryDate!.toLocal()),\r\n+                      icon: Icons.event_outlined,\r\n+                    ),\r\n+                ],\r\n+              ),\r\n+              const SizedBox(height: 14),\r\n+              Card(\r\n+                child: Padding(\r\n+                  padding: const EdgeInsets.all(14),\r\n+                  child: Row(\r\n+                    children: [\r\n+                      ProfileImage(\r\n+                        displayName: request.requesterName,\r\n+                        imageUrl: request.requesterPhoto,\r\n+                        size: 44,\r\n+                      ),\r\n+                      const SizedBox(width: 12),\r\n+                      Expanded(\r\n+                        child: Column(\r\n+                          crossAxisAlignment: CrossAxisAlignment.start,\r\n+                          children: [\r\n+                            Text(\r\n+                              request.requesterName,\r\n+                              style: theme.textTheme.titleMedium,\r\n+                              maxLines: 1,\r\n+                              overflow: TextOverflow.ellipsis,\r\n+                            ),\r\n+                            const SizedBox(height: 4),\r\n+                            Row(\r\n+                              children: [\r\n+                                Icon(Icons.star, size: 16, color: scheme.primary),\r\n+                                const SizedBox(width: 4),\r\n+                                Text(\r\n+                                  request.requesterRating.toStringAsFixed(1),\r\n+                                  style: theme.textTheme.bodySmall,\r\n+                                ),\r\n+                                const SizedBox(width: 12),\r\n+                                Text(\r\n+                                  'Posted ${dateFmt.format(request.createdAt.toLocal())}',\r\n+                                  style: theme.textTheme.bodySmall?.copyWith(color: scheme.onSurfaceVariant),\r\n+                                ),\r\n+                              ],\r\n+                            ),\r\n+                          ],\r\n+                        ),\r\n+                      ),\r\n+                    ],\r\n+                  ),\r\n+                ),\r\n+              ),\r\n+              const SizedBox(height: 12),\r\n+              _SectionCard(\r\n+                title: 'Route',\r\n+                child: Column(\r\n+                  children: [\r\n+                    _RouteRow(\r\n+                      icon: Icons.my_location_outlined,\r\n+                      title: 'Pickup',\r\n+                      city: request.pickupCity,\r\n+                      country: request.pickupCountry,\r\n+                      address: request.pickupAddress,\r\n+                    ),\r\n+                    const SizedBox(height: 12),\r\n+                    _RouteRow(\r\n+                      icon: Icons.location_on_outlined,\r\n+                      title: 'Delivery',\r\n+                      city: request.deliveryCity,\r\n+                      country: request.deliveryCountry,\r\n+                      address: request.deliveryAddress,\r\n+                    ),\r\n+                  ],\r\n+                ),\r\n+              ),\r\n+              const SizedBox(height: 12),\r\n+              _SectionCard(\r\n+                title: 'Recipient',\r\n+                child: Column(\r\n+                  children: [\r\n+                    _InfoRow(label: 'Name', value: request.recipientName),\r\n+                    const SizedBox(height: 8),\r\n+                    _InfoRow(label: 'Phone', value: request.recipientPhone),\r\n+                  ],\r\n+                ),\r\n+              ),\r\n+              const SizedBox(height: 12),\r\n+              if (request.description.trim().isNotEmpty)\r\n+                _SectionCard(\r\n+                  title: 'Notes',\r\n+                  child: Text(\r\n+                    request.description.trim(),\r\n+                    style: theme.textTheme.bodyMedium,\r\n+                  ),\r\n+                ),\r\n+              if (request.description.trim().isNotEmpty) const SizedBox(height: 12),\r\n+              _SectionCard(\r\n+                title: 'Details',\r\n+                child: Column(\r\n+                  children: [\r\n+                    _InfoRow(label: 'Status', value: _statusLabel(request.status)),\r\n+                    const SizedBox(height: 8),\r\n+                    _InfoRow(label: 'Last updated', value: dateFmt.format(request.updatedAt.toLocal())),\r\n+                    if (request.matchedTripId != null) ...[\r\n+                      const SizedBox(height: 8),\r\n+                      _InfoRow(label: 'Matched trip', value: request.matchedTripId!),\r\n+                    ],\r\n+                    if (request.matchedTravelerId != null) ...[\r\n+                      const SizedBox(height: 8),\r\n+                      _InfoRow(label: 'Matched traveler', value: request.matchedTravelerId!),\r\n+                    ],\r\n+                  ],\r\n+                ),\r\n+              ),\r\n+              if (isOwner && request.status == RequestStatus.active) ...[\r\n+                const SizedBox(height: 16),\r\n+                SizedBox(\r\n+                  width: double.infinity,\r\n+                  child: FilledButton.icon(\r\n+                    onPressed: () => context.push(\r\n+                      '${RoutePaths.requests}/${request.id}/matching-trips',\r\n+                    ),\r\n+                    icon: const Icon(Icons.search),\r\n+                    label: const Text('Find a Traveler'),\r\n+                  ),\r\n+                ),\r\n+              ],\r\n+            ],\r\n+          ),\r\n+        ),\r\n+      ],\r\n+    );\r\n+  }\r\n+}\r\n+\r\n+String _statusLabel(RequestStatus s) {\r\n+  return switch (s) {\r\n+    RequestStatus.active => 'Active',\r\n+    RequestStatus.matched => 'Matched',\r\n+    RequestStatus.inProgress => 'In progress',\r\n+    RequestStatus.completed => 'Completed',\r\n+    RequestStatus.cancelled => 'Cancelled',\r\n+  };\r\n+}\r\n+\r\n+class _StatusBadge extends StatelessWidget {\r\n+  const _StatusBadge({required this.status});\r\n+\r\n+  final RequestStatus status;\r\n+\r\n+  @override\r\n+  Widget build(BuildContext context) {\r\n+    final scheme = Theme.of(context).colorScheme;\r\n+\r\n+    final bg = switch (status) {\r\n+      RequestStatus.active => scheme.primaryContainer,\r\n+      RequestStatus.matched => scheme.secondaryContainer,\r\n+      RequestStatus.inProgress => scheme.tertiaryContainer,\r\n+      RequestStatus.completed => scheme.secondaryContainer,\r\n+      RequestStatus.cancelled => scheme.errorContainer,\r\n+    };\r\n+\r\n+    final fg = switch (status) {\r\n+      RequestStatus.active => scheme.onPrimaryContainer,\r\n+      RequestStatus.matched => scheme.onSecondaryContainer,\r\n+      RequestStatus.inProgress => scheme.onTertiaryContainer,\r\n+      RequestStatus.completed => scheme.onSecondaryContainer,\r\n+      RequestStatus.cancelled => scheme.onErrorContainer,\r\n+    };\r\n+\r\n+    return Container(\r\n+      padding: const EdgeInsets.symmetric(horizontal: 10, vertical: 6),\r\n+      decoration: BoxDecoration(\r\n+        color: bg,\r\n+        borderRadius: BorderRadius.circular(999),\r\n+      ),\r\n+      child: Text(\r\n+        _statusLabel(status),\r\n+        style: Theme.of(context).textTheme.labelSmall?.copyWith(color: fg),\r\n+      ),\r\n+    );\r\n+  }\r\n+}\r\n+\r\n+class _SectionCard extends StatelessWidget {\r\n+  const _SectionCard({required this.title, required this.child});\r\n+\r\n+  final String title;\r\n+  final Widget child;\r\n+\r\n+  @override\r\n+  Widget build(BuildContext context) {\r\n+    final theme = Theme.of(context);\r\n+\r\n+    return Card(\r\n+      child: Padding(\r\n+        padding: const EdgeInsets.all(14),\r\n+        child: Column(\r\n+          crossAxisAlignment: CrossAxisAlignment.start,\r\n+          children: [\r\n+            Text(title, style: theme.textTheme.titleSmall),\r\n+            const SizedBox(height: 10),\r\n+            child,\r\n+          ],\r\n+        ),\r\n+      ),\r\n+    );\r\n+  }\r\n+}\r\n+\r\n+class _RouteRow extends StatelessWidget {\r\n+  const _RouteRow({\r\n+    required this.icon,\r\n+    required this.title,\r\n+    required this.city,\r\n+    required this.country,\r\n+    required this.address,\r\n+  });\r\n+\r\n+  final IconData icon;\r\n+  final String title;\r\n+  final String city;\r\n+  final String country;\r\n+  final String address;\r\n+\r\n+  @override\r\n+  Widget build(BuildContext context) {\r\n+    final theme = Theme.of(context);\r\n+    final scheme = theme.colorScheme;\r\n+\r\n+    final cityText = city.trim().isEmpty ? '—' : city.trim();\r\n+    final countryText = country.trim().isEmpty ? '—' : country.trim();\r\n+    final addressText = address.trim().isEmpty ? '—' : address.trim();\r\n+\r\n+    return Row(\r\n+      crossAxisAlignment: CrossAxisAlignment.start,\r\n+      children: [\r\n+        Icon(icon, size: 18, color: scheme.onSurfaceVariant),\r\n+        const SizedBox(width: 10),\r\n+        Expanded(\r\n+          child: Column(\r\n+            crossAxisAlignment: CrossAxisAlignment.start,\r\n+            children: [\r\n+              Text(title, style: theme.textTheme.bodySmall?.copyWith(color: scheme.onSurfaceVariant)),\r\n+              const SizedBox(height: 2),\r\n+              Text(\r\n+                countryText,\r\n+                style: theme.textTheme.titleSmall,\r\n+                maxLines: 1,\r\n+                overflow: TextOverflow.ellipsis,\r\n+              ),\r\n+              const SizedBox(height: 2),\r\n+              Text(\r\n+                cityText,\r\n+                style: theme.textTheme.bodyMedium,\r\n+                maxLines: 1,\r\n+                overflow: TextOverflow.ellipsis,\r\n+              ),\r\n+              const SizedBox(height: 2),\r\n+              Text(\r\n+                addressText,\r\n+                style: theme.textTheme.bodySmall?.copyWith(color: scheme.onSurfaceVariant),\r\n+                maxLines: 2,\r\n+                overflow: TextOverflow.ellipsis,\r\n+              ),\r\n+            ],\r\n+          ),\r\n+        ),\r\n+      ],\r\n+    );\r\n+  }\r\n+}\r\n+\r\n+class _InfoRow extends StatelessWidget {\r\n+  const _InfoRow({required this.label, required this.value});\r\n+\r\n+  final String label;\r\n+  final String value;\r\n+\r\n+  @override\r\n+  Widget build(BuildContext context) {\r\n+    final theme = Theme.of(context);\r\n+    final scheme = theme.colorScheme;\r\n+\r\n+    return Row(\r\n+      crossAxisAlignment: CrossAxisAlignment.start,\r\n+      children: [\r\n+        SizedBox(\r\n+          width: 110,\r\n+          child: Text(label, style: theme.textTheme.bodySmall?.copyWith(color: scheme.onSurfaceVariant)),\r\n+        ),\r\n+        const SizedBox(width: 10),\r\n+        Expanded(\r\n+          child: Text(\r\n+            value,\r\n+            style: theme.textTheme.bodyMedium,\r\n+          ),\r\n+        ),\r\n+      ],\r\n+    );\r\n+  }\r\n+}\r\n+\r\n+class _MetaChip extends StatelessWidget {\r\n+  const _MetaChip({\r\n+    required this.text,\r\n+    required this.icon,\r\n+    this.emphasize = false,\r\n+  });\r\n+\r\n+  final String text;\r\n+  final IconData icon;\r\n+  final bool emphasize;\r\n+\r\n+  @override\r\n+  Widget build(BuildContext context) {\r\n+    final theme = Theme.of(context);\r\n+    final scheme = theme.colorScheme;\r\n+\r\n+    final bg = emphasize ? scheme.primaryContainer : scheme.surfaceContainerHighest;\r\n+    final fg = emphasize ? scheme.onPrimaryContainer : scheme.onSurfaceVariant;\r\n+\r\n+    return Container(\r\n+      padding: const EdgeInsets.symmetric(horizontal: 10, vertical: 7),\r\n+      decoration: BoxDecoration(\r\n+        color: bg,\r\n+        borderRadius: BorderRadius.circular(999),\r\n+      ),\r\n+      child: Row(\r\n+        mainAxisSize: MainAxisSize.min,\r\n+        children: [\r\n+          Icon(icon, size: 16, color: fg),\r\n+          const SizedBox(width: 6),\r\n+          Text(text, style: theme.textTheme.bodySmall?.copyWith(color: fg)),\r\n+        ],\r\n+      ),\r\n+    );\r\n+  }\r\n+}\r\n"
                }
            ],
            "date": 1768061206348,
            "name": "Commit-0",
            "content": "import 'package:flutter/material.dart';\r\nimport 'package:flutter_bloc/flutter_bloc.dart';\r\nimport 'package:get_it/get_it.dart';\r\nimport 'package:go_router/go_router.dart';\r\nimport 'package:intl/intl.dart';\r\n\r\nimport '../../../../config/routes.dart';\r\nimport '../../../auth/bloc/auth_bloc.dart';\r\nimport '../../../auth/bloc/auth_state.dart';\r\nimport '../../bloc/request_bloc.dart';\r\nimport '../../bloc/request_event.dart';\r\nimport '../../bloc/request_state.dart';\r\nimport '../../data/models/request_model.dart';\r\nimport '../widgets/image_carousel.dart';\r\n\r\nclass RequestDetailsScreen extends StatelessWidget {\r\n  const RequestDetailsScreen({\r\n    super.key,\r\n    required this.requestId,\r\n  });\r\n\r\n  final String requestId;\r\n\r\n  @override\r\n  Widget build(BuildContext context) {\r\n    return BlocProvider<RequestBloc>(\r\n      create: (_) => GetIt.instance<RequestBloc>()\r\n        ..add(RequestDetailsRequested(requestId)),\r\n      child: BlocConsumer<RequestBloc, RequestState>(\r\n        listenWhen: (_, s) => s is RequestError || s is RequestCancelled,\r\n        listener: (context, state) {\r\n          if (state is RequestError) {\r\n            ScaffoldMessenger.of(context)\r\n                .showSnackBar(SnackBar(content: Text(state.message)));\r\n          }\r\n          if (state is RequestCancelled) {\r\n            ScaffoldMessenger.of(context).showSnackBar(\r\n              const SnackBar(content: Text('Request cancelled')),\r\n            );\r\n          }\r\n        },\r\n        builder: (context, state) {\r\n          final request = state is RequestDetailsLoaded ? state.request : null;\r\n\r\n          return Scaffold(\r\n            appBar: AppBar(\r\n              title: const Text('Request Details'),\r\n              actions: [\r\n                if (request != null) _buildOwnerActions(context, request),\r\n              ],\r\n            ),\r\n            body: switch (state) {\r\n              RequestLoading() =>\r\n                const Center(child: CircularProgressIndicator()),\r\n              RequestError() => Center(child: Text(state.message)),\r\n              RequestDetailsLoaded() =>\r\n                _RequestDetailsBody(request: state.request),\r\n              _ => const Center(child: CircularProgressIndicator()),\r\n            },\r\n          );\r\n        },\r\n      ),\r\n    );\r\n  }\r\n\r\n  Widget _buildOwnerActions(BuildContext context, RequestModel request) {\r\n    final authState = context.read<AuthBloc>().state;\r\n    final isOwner = authState is AuthAuthenticated &&\r\n        authState.user.uid == request.requesterId;\r\n\r\n    if (!isOwner) return const SizedBox.shrink();\r\n\r\n    return PopupMenuButton<String>(\r\n      onSelected: (v) {\r\n        if (v == 'edit') {\r\n          context.push(RoutePaths.requestsCreate, extra: request);\r\n          return;\r\n        }\r\n        if (v == 'cancel') {\r\n          context.read<RequestBloc>().add(RequestCancelRequested(request.id));\r\n        }\r\n      },\r\n      itemBuilder: (context) {\r\n        return <PopupMenuEntry<String>>[\r\n          const PopupMenuItem<String>(\r\n            value: 'edit',\r\n            child: Text('Edit'),\r\n          ),\r\n          if (request.status == RequestStatus.active)\r\n            const PopupMenuItem<String>(\r\n              value: 'cancel',\r\n              child: Text('Cancel'),\r\n            ),\r\n        ];\r\n      },\r\n    );\r\n  }\r\n}\r\n\r\nclass _RequestDetailsBody extends StatelessWidget {\r\n  const _RequestDetailsBody({required this.request});\r\n\r\n  final RequestModel request;\r\n\r\n  @override\r\n  Widget build(BuildContext context) {\r\n    final theme = Theme.of(context);\r\n    final scheme = theme.colorScheme;\r\n\r\n    final authState = context.read<AuthBloc>().state;\r\n    final isOwner = authState is AuthAuthenticated &&\r\n        authState.user.uid == request.requesterId;\r\n\r\n    final dateFmt = DateFormat('MMM d, y');\r\n\r\n    return ListView(\r\n      padding: EdgeInsets.zero,\r\n      children: [\r\n        if (request.imageUrls.isNotEmpty)\r\n          ImageCarousel(urls: request.imageUrls)\r\n        else\r\n          Container(\r\n            height: 240,\r\n            color: scheme.surfaceContainerHighest,\r\n            alignment: Alignment.center,\r\n            child: Icon(Icons.image_not_supported_outlined, color: scheme.onSurfaceVariant),\r\n          ),\r\n        Padding(\r\n          padding: const EdgeInsets.fromLTRB(16, 16, 16, 24),\r\n          child: Column(\r\n            crossAxisAlignment: CrossAxisAlignment.start,\r\n            children: [\r\n              Row(\r\n                crossAxisAlignment: CrossAxisAlignment.start,\r\n                children: [\r\n                  Expanded(\r\n                    child: Text(\r\n                      request.title,\r\n                      style: theme.textTheme.headlineSmall?.copyWith(fontWeight: FontWeight.w700),\r\n                    ),\r\n                  ),\r\n                  const SizedBox(width: 10),\r\n                  _StatusBadge(status: request.status),\r\n                ],\r\n              ),\r\n              const SizedBox(height: 10),\r\n              Wrap(\r\n                spacing: 8,\r\n                runSpacing: 8,\r\n                children: [\r\n                  _MetaChip(text: request.categoryDisplay, icon: Icons.category_outlined),\r\n                  _MetaChip(\r\n                    text: '${request.weightKg.toStringAsFixed(1)} kg',\r\n                    icon: Icons.scale_outlined,\r\n                  ),\r\n                  if (request.isUrgent)\r\n                    _MetaChip(\r\n                      text: 'Urgent',\r\n                      icon: Icons.bolt,\r\n                      emphasize: true,\r\n                    ),\r\n                  if (request.offeredPrice != null)\r\n                    _MetaChip(\r\n                      text: '${request.offeredPrice!.toStringAsFixed(2)}',\r\n                      icon: Icons.payments_outlined,\r\n                    ),\r\n                  if (request.preferredDeliveryDate != null)\r\n                    _MetaChip(\r\n                      text: dateFmt.format(request.preferredDeliveryDate!.toLocal()),\r\n                      icon: Icons.event_outlined,\r\n                    ),\r\n                ],\r\n              ),\r\n              const SizedBox(height: 14),\r\n              Card(\r\n                child: Padding(\r\n                  padding: const EdgeInsets.all(14),\r\n                  child: Row(\r\n                    children: [\r\n                      ProfileImage(\r\n                        displayName: request.requesterName,\r\n                        imageUrl: request.requesterPhoto,\r\n                        size: 44,\r\n                      ),\r\n                      const SizedBox(width: 12),\r\n                      Expanded(\r\n                        child: Column(\r\n                          crossAxisAlignment: CrossAxisAlignment.start,\r\n                          children: [\r\n                            Text(\r\n                              request.requesterName,\r\n                              style: theme.textTheme.titleMedium,\r\n                              maxLines: 1,\r\n                              overflow: TextOverflow.ellipsis,\r\n                            ),\r\n                            const SizedBox(height: 4),\r\n                            Row(\r\n                              children: [\r\n                                Icon(Icons.star, size: 16, color: scheme.primary),\r\n                                const SizedBox(width: 4),\r\n                                Text(\r\n                                  request.requesterRating.toStringAsFixed(1),\r\n                                  style: theme.textTheme.bodySmall,\r\n                                ),\r\n                                const SizedBox(width: 12),\r\n                                Text(\r\n                                  'Posted ${dateFmt.format(request.createdAt.toLocal())}',\r\n                                  style: theme.textTheme.bodySmall?.copyWith(color: scheme.onSurfaceVariant),\r\n                                ),\r\n                              ],\r\n                            ),\r\n                          ],\r\n                        ),\r\n                      ),\r\n                    ],\r\n                  ),\r\n                ),\r\n              ),\r\n              const SizedBox(height: 12),\r\n              _SectionCard(\r\n                title: 'Route',\r\n                child: Column(\r\n                  children: [\r\n                    _RouteRow(\r\n                      icon: Icons.my_location_outlined,\r\n                      title: 'Pickup',\r\n                      city: request.pickupCity,\r\n                      country: request.pickupCountry,\r\n                      address: request.pickupAddress,\r\n                    ),\r\n                    const SizedBox(height: 12),\r\n                    _RouteRow(\r\n                      icon: Icons.location_on_outlined,\r\n                      title: 'Delivery',\r\n                      city: request.deliveryCity,\r\n                      country: request.deliveryCountry,\r\n                      address: request.deliveryAddress,\r\n                    ),\r\n                  ],\r\n                ),\r\n              ),\r\n              const SizedBox(height: 12),\r\n              _SectionCard(\r\n                title: 'Recipient',\r\n                child: Column(\r\n                  children: [\r\n                    _InfoRow(label: 'Name', value: request.recipientName),\r\n                    const SizedBox(height: 8),\r\n                    _InfoRow(label: 'Phone', value: request.recipientPhone),\r\n                  ],\r\n                ),\r\n              ),\r\n              const SizedBox(height: 12),\r\n              if (request.description.trim().isNotEmpty)\r\n                _SectionCard(\r\n                  title: 'Notes',\r\n                  child: Text(\r\n                    request.description.trim(),\r\n                    style: theme.textTheme.bodyMedium,\r\n                  ),\r\n                ),\r\n              if (request.description.trim().isNotEmpty) const SizedBox(height: 12),\r\n              _SectionCard(\r\n                title: 'Details',\r\n                child: Column(\r\n                  children: [\r\n                    _InfoRow(label: 'Status', value: _statusLabel(request.status)),\r\n                    const SizedBox(height: 8),\r\n                    _InfoRow(label: 'Last updated', value: dateFmt.format(request.updatedAt.toLocal())),\r\n                    if (request.matchedTripId != null) ...[\r\n                      const SizedBox(height: 8),\r\n                      _InfoRow(label: 'Matched trip', value: request.matchedTripId!),\r\n                    ],\r\n                    if (request.matchedTravelerId != null) ...[\r\n                      const SizedBox(height: 8),\r\n                      _InfoRow(label: 'Matched traveler', value: request.matchedTravelerId!),\r\n                    ],\r\n                  ],\r\n                ),\r\n              ),\r\n              if (isOwner && request.status == RequestStatus.active) ...[\r\n                const SizedBox(height: 16),\r\n                SizedBox(\r\n                  width: double.infinity,\r\n                  child: FilledButton.icon(\r\n                    onPressed: () => context.push(\r\n                      '${RoutePaths.requests}/${request.id}/matching-trips',\r\n                    ),\r\n                    icon: const Icon(Icons.search),\r\n                    label: const Text('Find a Traveler'),\r\n                  ),\r\n                ),\r\n              ],\r\n            ],\r\n          ),\r\n        ),\r\n      ],\r\n    );\r\n  }\r\n}\r\n\r\nString _statusLabel(RequestStatus s) {\r\n  return switch (s) {\r\n    RequestStatus.active => 'Active',\r\n    RequestStatus.matched => 'Matched',\r\n    RequestStatus.inProgress => 'In progress',\r\n    RequestStatus.completed => 'Completed',\r\n    RequestStatus.cancelled => 'Cancelled',\r\n  };\r\n}\r\n\r\nclass _StatusBadge extends StatelessWidget {\r\n  const _StatusBadge({required this.status});\r\n\r\n  final RequestStatus status;\r\n\r\n  @override\r\n  Widget build(BuildContext context) {\r\n    final scheme = Theme.of(context).colorScheme;\r\n\r\n    final bg = switch (status) {\r\n      RequestStatus.active => scheme.primaryContainer,\r\n      RequestStatus.matched => scheme.secondaryContainer,\r\n      RequestStatus.inProgress => scheme.tertiaryContainer,\r\n      RequestStatus.completed => scheme.secondaryContainer,\r\n      RequestStatus.cancelled => scheme.errorContainer,\r\n    };\r\n\r\n    final fg = switch (status) {\r\n      RequestStatus.active => scheme.onPrimaryContainer,\r\n      RequestStatus.matched => scheme.onSecondaryContainer,\r\n      RequestStatus.inProgress => scheme.onTertiaryContainer,\r\n      RequestStatus.completed => scheme.onSecondaryContainer,\r\n      RequestStatus.cancelled => scheme.onErrorContainer,\r\n    };\r\n\r\n    return Container(\r\n      padding: const EdgeInsets.symmetric(horizontal: 10, vertical: 6),\r\n      decoration: BoxDecoration(\r\n        color: bg,\r\n        borderRadius: BorderRadius.circular(999),\r\n      ),\r\n      child: Text(\r\n        _statusLabel(status),\r\n        style: Theme.of(context).textTheme.labelSmall?.copyWith(color: fg),\r\n      ),\r\n    );\r\n  }\r\n}\r\n\r\nclass _SectionCard extends StatelessWidget {\r\n  const _SectionCard({required this.title, required this.child});\r\n\r\n  final String title;\r\n  final Widget child;\r\n\r\n  @override\r\n  Widget build(BuildContext context) {\r\n    final theme = Theme.of(context);\r\n\r\n    return Card(\r\n      child: Padding(\r\n        padding: const EdgeInsets.all(14),\r\n        child: Column(\r\n          crossAxisAlignment: CrossAxisAlignment.start,\r\n          children: [\r\n            Text(title, style: theme.textTheme.titleSmall),\r\n            const SizedBox(height: 10),\r\n            child,\r\n          ],\r\n        ),\r\n      ),\r\n    );\r\n  }\r\n}\r\n\r\nclass _RouteRow extends StatelessWidget {\r\n  const _RouteRow({\r\n    required this.icon,\r\n    required this.title,\r\n    required this.city,\r\n    required this.country,\r\n    required this.address,\r\n  });\r\n\r\n  final IconData icon;\r\n  final String title;\r\n  final String city;\r\n  final String country;\r\n  final String address;\r\n\r\n  @override\r\n  Widget build(BuildContext context) {\r\n    final theme = Theme.of(context);\r\n    final scheme = theme.colorScheme;\r\n\r\n    final cityText = city.trim().isEmpty ? '—' : city.trim();\r\n    final countryText = country.trim().isEmpty ? '—' : country.trim();\r\n    final addressText = address.trim().isEmpty ? '—' : address.trim();\r\n\r\n    return Row(\r\n      crossAxisAlignment: CrossAxisAlignment.start,\r\n      children: [\r\n        Icon(icon, size: 18, color: scheme.onSurfaceVariant),\r\n        const SizedBox(width: 10),\r\n        Expanded(\r\n          child: Column(\r\n            crossAxisAlignment: CrossAxisAlignment.start,\r\n            children: [\r\n              Text(title, style: theme.textTheme.bodySmall?.copyWith(color: scheme.onSurfaceVariant)),\r\n              const SizedBox(height: 2),\r\n              Text(\r\n                countryText,\r\n                style: theme.textTheme.titleSmall,\r\n                maxLines: 1,\r\n                overflow: TextOverflow.ellipsis,\r\n              ),\r\n              const SizedBox(height: 2),\r\n              Text(\r\n                cityText,\r\n                style: theme.textTheme.bodyMedium,\r\n                maxLines: 1,\r\n                overflow: TextOverflow.ellipsis,\r\n              ),\r\n              const SizedBox(height: 2),\r\n              Text(\r\n                addressText,\r\n                style: theme.textTheme.bodySmall?.copyWith(color: scheme.onSurfaceVariant),\r\n                maxLines: 2,\r\n                overflow: TextOverflow.ellipsis,\r\n              ),\r\n            ],\r\n          ),\r\n        ),\r\n      ],\r\n    );\r\n  }\r\n}\r\n\r\nclass _InfoRow extends StatelessWidget {\r\n  const _InfoRow({required this.label, required this.value});\r\n\r\n  final String label;\r\n  final String value;\r\n\r\n  @override\r\n  Widget build(BuildContext context) {\r\n    final theme = Theme.of(context);\r\n    final scheme = theme.colorScheme;\r\n\r\n    return Row(\r\n      crossAxisAlignment: CrossAxisAlignment.start,\r\n      children: [\r\n        SizedBox(\r\n          width: 110,\r\n          child: Text(label, style: theme.textTheme.bodySmall?.copyWith(color: scheme.onSurfaceVariant)),\r\n        ),\r\n        const SizedBox(width: 10),\r\n        Expanded(\r\n          child: Text(\r\n            value,\r\n            style: theme.textTheme.bodyMedium,\r\n          ),\r\n        ),\r\n      ],\r\n    );\r\n  }\r\n}\r\n\r\nclass _MetaChip extends StatelessWidget {\r\n  const _MetaChip({\r\n    required this.text,\r\n    required this.icon,\r\n    this.emphasize = false,\r\n  });\r\n\r\n  final String text;\r\n  final IconData icon;\r\n  final bool emphasize;\r\n\r\n  @override\r\n  Widget build(BuildContext context) {\r\n    final theme = Theme.of(context);\r\n    final scheme = theme.colorScheme;\r\n\r\n    final bg = emphasize ? scheme.primaryContainer : scheme.surfaceContainerHighest;\r\n    final fg = emphasize ? scheme.onPrimaryContainer : scheme.onSurfaceVariant;\r\n\r\n    return Container(\r\n      padding: const EdgeInsets.symmetric(horizontal: 10, vertical: 7),\r\n      decoration: BoxDecoration(\r\n        color: bg,\r\n        borderRadius: BorderRadius.circular(999),\r\n      ),\r\n      child: Row(\r\n        mainAxisSize: MainAxisSize.min,\r\n        children: [\r\n          Icon(icon, size: 16, color: fg),\r\n          const SizedBox(width: 6),\r\n          Text(text, style: theme.textTheme.bodySmall?.copyWith(color: fg)),\r\n        ],\r\n      ),\r\n    );\r\n  }\r\n}\r\n"
        }
    ]
}