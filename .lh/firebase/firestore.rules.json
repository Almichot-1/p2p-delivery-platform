{
    "sourceFile": "firebase/firestore.rules",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1766400696141,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1766400791698,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -21,106 +21,6 @@\n \r\n     match /{document=**} {\r\n       allow read, write: if isSignedIn();\r\n     }\r\n-          && data.createdAt == oldData.createdAt\r\n-          && data.status in validStatuses;\r\n-      }\r\n-      \r\n-      // Messages subcollection\r\n-      match /messages/{messageId} {\r\n-        // Only participants can read messages\r\n-        allow read: if isAuthenticated()\r\n-          && request.auth.uid in get(/databases/$(database)/documents/matches/$(matchId)).data.participants;\r\n-        \r\n-        // Only participants can send messages\r\n-        allow create: if isAuthenticated()\r\n-          && request.auth.uid in get(/databases/$(database)/documents/matches/$(matchId)).data.participants\r\n-          && validateMessageCreate();\r\n-        \r\n-        // Messages cannot be updated or deleted\r\n-        allow update, delete: if false;\r\n-        \r\n-        function validateMessageCreate() {\r\n-          let data = request.resource.data;\r\n-          return data.senderId == request.auth.uid\r\n-            && isValidString(data.content, 1, 5000)\r\n-            && data.timestamp == request.time;\r\n-        }\r\n-      }\r\n-    }\r\n-    \r\n-    // ============================================\r\n-    // REVIEWS COLLECTION\r\n-    // ============================================\r\n-    match /reviews/{reviewId} {\r\n-      // Anyone can read reviews\r\n-      allow read: if isAuthenticated();\r\n-      \r\n-      // Verified users can create reviews\r\n-      allow create: if isVerified() && validateReviewCreate();\r\n-      \r\n-      // Reviews cannot be updated or deleted\r\n-      allow update, delete: if false;\r\n-      \r\n-      function validateReviewCreate() {\r\n-        let data = request.resource.data;\r\n-        return data.keys().hasAll([\r\n-          'matchId', 'reviewerId', 'revieweeId',\r\n-          'rating', 'createdAt'\r\n-        ])\r\n-        && data.reviewerId == request.auth.uid\r\n-        && data.reviewerId != data.revieweeId\r\n-        && data.rating >= 1\r\n-        && data.rating <= 5\r\n-        && data.createdAt == request.time;\r\n-      }\r\n-    }\r\n-    \r\n-    // ============================================\r\n-    // NOTIFICATIONS COLLECTION\r\n-    // ============================================\r\n-    match /notifications/{notificationId} {\r\n-      // Users can only read their own notifications\r\n-      allow read: if isAuthenticated() \r\n-        && resource.data.userId == request.auth.uid;\r\n-      \r\n-      // Users can mark their notifications as read\r\n-      allow update: if isAuthenticated()\r\n-        && resource.data.userId == request.auth.uid\r\n-        && request.resource.data.diff(resource.data).affectedKeys().hasOnly(['isRead']);\r\n-      \r\n-      // Created by Cloud Functions only\r\n-      allow create, delete: if false;\r\n-    }\r\n-    \r\n-    // ============================================\r\n-    // REPORTS COLLECTION (for moderation)\r\n-    // ============================================\r\n-    match /reports/{reportId} {\r\n-      // Only admins can read\r\n-      allow read: if isAdmin();\r\n-      \r\n-      // Any verified user can create a report\r\n-      allow create: if isVerified() && validateReportCreate();\r\n-      \r\n-      // Only admins can update/delete\r\n-      allow update, delete: if isAdmin();\r\n-      \r\n-      function validateReportCreate() {\r\n-        let data = request.resource.data;\r\n-        return data.reporterId == request.auth.uid\r\n-          && isValidString(data.reason, 10, 1000)\r\n-          && data.createdAt == request.time\r\n-          && data.status == 'pending';\r\n-      }\r\n-    }\r\n-    \r\n-    // ============================================\r\n-    // SYSTEM COLLECTION (app config, read-only)\r\n-    // ============================================\r\n-    match /system/{document=**} {\r\n-      allow read: if isAuthenticated();\r\n-      allow write: if isAdmin();\r\n-    }\r\n   }\r\n }\n\\ No newline at end of file\n"
                }
            ],
            "date": 1766400696141,
            "name": "Commit-0",
            "content": "rules_version = '2';\r\nservice cloud.firestore {\r\n  match /databases/{database}/documents {\r\n    function isSignedIn() {\r\n      return request.auth != null;\r\n    }\r\n\r\n    function isSelf(userId) {\r\n      return isSignedIn() && request.auth.uid == userId;\r\n    }\r\n\r\n    // Development rules:\r\n    // - Allow any authenticated user to read/write all app data.\r\n    // - Restrict user profile documents to the owning user.\r\n    // Tighten these before production.\r\n\r\n    match /users/{userId} {\r\n      allow read: if isSignedIn();\r\n      allow create, update, delete: if isSelf(userId);\r\n    }\r\n\r\n    match /{document=**} {\r\n      allow read, write: if isSignedIn();\r\n    }\r\n          && data.createdAt == oldData.createdAt\r\n          && data.status in validStatuses;\r\n      }\r\n      \r\n      // Messages subcollection\r\n      match /messages/{messageId} {\r\n        // Only participants can read messages\r\n        allow read: if isAuthenticated()\r\n          && request.auth.uid in get(/databases/$(database)/documents/matches/$(matchId)).data.participants;\r\n        \r\n        // Only participants can send messages\r\n        allow create: if isAuthenticated()\r\n          && request.auth.uid in get(/databases/$(database)/documents/matches/$(matchId)).data.participants\r\n          && validateMessageCreate();\r\n        \r\n        // Messages cannot be updated or deleted\r\n        allow update, delete: if false;\r\n        \r\n        function validateMessageCreate() {\r\n          let data = request.resource.data;\r\n          return data.senderId == request.auth.uid\r\n            && isValidString(data.content, 1, 5000)\r\n            && data.timestamp == request.time;\r\n        }\r\n      }\r\n    }\r\n    \r\n    // ============================================\r\n    // REVIEWS COLLECTION\r\n    // ============================================\r\n    match /reviews/{reviewId} {\r\n      // Anyone can read reviews\r\n      allow read: if isAuthenticated();\r\n      \r\n      // Verified users can create reviews\r\n      allow create: if isVerified() && validateReviewCreate();\r\n      \r\n      // Reviews cannot be updated or deleted\r\n      allow update, delete: if false;\r\n      \r\n      function validateReviewCreate() {\r\n        let data = request.resource.data;\r\n        return data.keys().hasAll([\r\n          'matchId', 'reviewerId', 'revieweeId',\r\n          'rating', 'createdAt'\r\n        ])\r\n        && data.reviewerId == request.auth.uid\r\n        && data.reviewerId != data.revieweeId\r\n        && data.rating >= 1\r\n        && data.rating <= 5\r\n        && data.createdAt == request.time;\r\n      }\r\n    }\r\n    \r\n    // ============================================\r\n    // NOTIFICATIONS COLLECTION\r\n    // ============================================\r\n    match /notifications/{notificationId} {\r\n      // Users can only read their own notifications\r\n      allow read: if isAuthenticated() \r\n        && resource.data.userId == request.auth.uid;\r\n      \r\n      // Users can mark their notifications as read\r\n      allow update: if isAuthenticated()\r\n        && resource.data.userId == request.auth.uid\r\n        && request.resource.data.diff(resource.data).affectedKeys().hasOnly(['isRead']);\r\n      \r\n      // Created by Cloud Functions only\r\n      allow create, delete: if false;\r\n    }\r\n    \r\n    // ============================================\r\n    // REPORTS COLLECTION (for moderation)\r\n    // ============================================\r\n    match /reports/{reportId} {\r\n      // Only admins can read\r\n      allow read: if isAdmin();\r\n      \r\n      // Any verified user can create a report\r\n      allow create: if isVerified() && validateReportCreate();\r\n      \r\n      // Only admins can update/delete\r\n      allow update, delete: if isAdmin();\r\n      \r\n      function validateReportCreate() {\r\n        let data = request.resource.data;\r\n        return data.reporterId == request.auth.uid\r\n          && isValidString(data.reason, 10, 1000)\r\n          && data.createdAt == request.time\r\n          && data.status == 'pending';\r\n      }\r\n    }\r\n    \r\n    // ============================================\r\n    // SYSTEM COLLECTION (app config, read-only)\r\n    // ============================================\r\n    match /system/{document=**} {\r\n      allow read: if isAuthenticated();\r\n      allow write: if isAdmin();\r\n    }\r\n  }\r\n}"
        }
    ]
}